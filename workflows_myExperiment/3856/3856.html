








  


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="google-site-verification" content="3hq0Cfhw5_-EaaNMum0ETX847sTl7jeQ3ZNAla4a6UQ" />
  
  <title>myExperiment &#45; Workflows &#45; BioVeL ESW STACK - ENM Statistical Workflow with raster stack computation (Robert Kulawik) [Taverna 2 Workflow]</title>
  <link rel="alternate" href="http://www.myexperiment.org/workflows/3856.rdf" type="application/rdf+xml" title="RDF+XML" />
  <link rel="alternate" href="http://www.myexperiment.org/workflows/3856.xml" type="application/xml" title="REST XML" />
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
  <link href="/stylesheets/acts_as_taggable_stylesheet.css?1680607579" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/star_rating.css?1680607579" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/gadgets.css?1680607579" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/misc_skinning.css?1680607579" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/pagination.css?1680607579" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/bootstrap.css?1680607579" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/navbar.css?1680607579" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/styles.css?1680607579" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/biovel.css?1680607579" media="screen" rel="stylesheet" type="text/css" />
  <script src="/javascripts/jquery-1.11.1.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/jquery-noconflict.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/prototype-1.7.2-patched.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/effects.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/dragdrop.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/controls.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/boxover.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/bootstrap.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/tabs.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/folds.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/application.js?1680607579" type="text/javascript"></script>

  
  






  
  
    <script src='//www.google.com/recaptcha/api.js'></script>
  
</head>
<body>



<div class="navbar navbar-myexp" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
          
  <a href="http://biovel.eu/" style="float: left"><img alt="Biovel_logo_white_background" height="50" src="/images/biovel_logo_white_background.png?1680607579" width="38" /></a>
      
    </div>
    <div class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        
          
  <ul class="nav navbar-nav">
    
      <li >
        <a href="/groups/643">BioVeL</a>      </li>
    
      <li id="selected_tabnav">
        <a href="/groups/643/workflows">Workflows</a>      </li>
    
      <li >
        <a href="/groups/643/files">Files</a>      </li>
    
      <li >
        <a href="/groups/643/packs">Packs</a>      </li>
    
  </ul>

        
        
            <form action="/search" class="navbar-form navbar-left" id="search" method="get">
    <div class="input-group">
      <input class="form-control" id="query" name="query" placeholder="Search" type="text" />
      <span class="input-group-btn">
        
        <input class="btn btn-default" name="commit" type="submit" value="Go" />
        </span>
    </div>
</form>

        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
            <li><a href="/session/new?return_to=%2Fworkflows%2F3856.html">Log in</a></li>
    <li><a href="/users/new">Register</a></li>


      </ul>
    </div><!--/.nav-collapse -->
  </div>
  
      <div id="site_info_links">
        <div class="container">
          
    <a href="/home">Back to <img alt="Logo_tiny" src="/images/logo_tiny.png?1680607579" style="vertical-align: bottom" /></a>    <span class="divider">|</span>
    <a href="http://www.biovel.eu/about-biovel" target="blank">About BioVeL</a>
    <span class="divider">|</span>
    <a href="http://portal.biovel.eu" target="blank">BioVeL Portal</a>
    <span class="divider">|</span>
    <a href="https://www.biodiversitycatalogue.org/" target="blank">Biodiversity Catalogue</a>

        </div>
      </div>
  
</div>




    <div class="container" id="main">
      <div id="myexp_breadcrumbs_bar">
        <ol class="breadcrumb">
  <li><a href="/home">Home</a></li>
  


  <li><a href="/workflows">Workflows</a></li>



  
    <li>BioVeL ESW STACK - ENM Statistical Workflow with raster stack computation</li>
  


  <div style="float: right"></div>
</ol>

      </div>
      <div id="myexp_content">
        


        



<h1 class="contribution_title">
  BioVeL ESW STACK - ENM Statistical Workflow with raster stack computation
</h1>

<div class="contribution_aftertitle">
	<b>Created:</b> 2013-10-13 12:27:09
	
		&nbsp;&nbsp;&nbsp;&nbsp;
		<b>Last updated: </b>2016-06-22 14:45:58
	
</div>
<ul class="sectionIcons">
  
      <li><span class="icon"><a href="http://www.myexperiment.org/workflows/3856/download/BioVeL_ESW_STACK_-_ENM_Statistical_Workflow_with_raster_stack_computation-v5.t2flow?version=5"><img alt="Download Workflow (for version 5)" src="/images/redmond_studio/arrow-down_16.png?1680607579" /> Download Workflow</a></span></li>
      
  
      
</ul>


<div class="contribution_left_box">

  <div class="contribution_version_box">



    <div class="contribution_version_inner_box">

      
    <div class="contribution_description">
      <p>
The ENM Statistical Stack Workflow (ESW STACK) allows the computation of the extent, intensity and a cummulated potential species distribution through computation of an average sum layer from the input raster layers using the R statistical environment (R Core Team 2013). The sum layer is computed from all input files. e.g from different distribution of species as a mean value from each corresponding raster cell values, coming from the Ecological Niche Modelling (ENM) Workflow (<a href="http://www.myexperiment.org/workflows/3355" rel="nofollow">http://www.myexperiment.org/workflows/3355</a>).
</p>

<p>
The average sum layer computed from each corresponding raster cell values is stored together with all input layers in a multilayer stack file, regardless of the input files’ geographical extent and origin. If the files have a different geographical extent and/or origin, the raster-diff workflow automatically crop them to the same extent and resample the values using the “nearest neighbour” method, resulting in a perfect cell match between the two rasters. The resulting values in the average sum file depends of the value range of the input files and will be normalized to their value range. 
</p>

<p>
The values of the input layers and the average sum layer are classified into six positive classes. The predicted differences are presented for each species as a heat map, where cells with colors from green to red indicate an increase and from green to blue a decrease of predicted potential for a species. The workflow enables the computation of overall coverage, overall intensity and the difference in intensity or coverage between two raster layers. Overall coverage is computed as the percentage of raster cells with values >0, and overall intensity is computed as the sum of all valued cells divided by the number of raster cells. Summary statistics for the raster layers are also provided: number of raster cells, mean intensity, median, CV, SD, Min value, Max value and number of cells outside the mask.
</p>

<p>
The workflow contains the computation methods:
</p>

<p>
- Computation of the average sum layer:
</p>

<p>
sum_layer = sum(layerstack, na.rm=FALSE)
average_sum_layer = (sum_layer /(nlayers(layerstack)*maxValue)) * maxValue.
</p>

<p>
- Computation of the overall coverage and intensity
overall_coverage = ((ncell(x)-cellStats(x, 'countNA')-count(x,0))/(ncell(x)-cellStats(x, 'countNA')))*100 
overall_intensity = cellStats(x, sum)/(ncell(x)-cellStats(x, 'countNA')) 
</p>

<p>
- Computation of the covariance matrix:
</p>

<p>
The covariance (the measure of how much two random variables change together)matrix will be computed using  standard functions in R: layerStats(layerstack,"cov",na.rm=TRUE) with excusion of noData values.
</p>

<p>
- Used standard R functions:
</p>

<p>
cellStats: <a href="https://r-forge.r-project.org/scm/viewvc.php/pkg/raster/R/cellStats.R?view=markup&amp;root=raster" rel="nofollow">https://r-forge.r-project.org/scm/viewvc.php/pkg/raster/R/cellStats.R?view=markup&amp;root=raster</a>
layerStats: <a href="https://r-forge.r-project.org/scm/viewvc.php/pkg/raster/R/layerStats.R?view=markup&amp;root=raster" rel="nofollow">https://r-forge.r-project.org/scm/viewvc.php/pkg/raster/R/layerStats.R?view=markup&amp;root=raster</a>
</p>

<p>
This workflow create a multilayer stack file as output and create PNG thumbnais and PNG overwiews from the input files and the average sum layer. A second multilayer stack can display different pointsets relatet to each PNG
</p>

<p>
The PNG overview will be created with these values (corresponding to the Geoserver style)
ERDASImagine file:
</p>

<p>
breakpoints = c(0,1,25,50,75,100)
GeoTIFF file
breakpoints = c(0,2,63,127,190,254)
colors =  c(rgb(1.0,1.0,1.0), rgb(0.996,0.898,0.851), rgb(0.988,0.682,0.569), rgb(0.984,0.416,0.290), rgb(0.871,0.176,0.149), rgb(0.647,0.059,0.082))
</p>

<p>
Expected as input files are those raster images as a URL reference e.g. output files from openModeller created by an ENM workflow.
*A file upload into the workflow is not possible, only a reference to the input file as URL*
</p>

<p>
Supported formats are:
</p>

<p>
- ERDASImagine (.img) files with a value range 0 - 100, noData value 101
- GeoTIFF (.tif) files with a value range 0- 254, noData Value 255
</p>

<p>
Input files with a different extent will be intersected to a common extent and resampled to each other using the "nearest neighbor" sampling method.
</p>

<p>
For working with the ESW in a own localhost an R instance should by installed on a own machine (<a href="http://cran.r-project.org/" rel="nofollow">http://cran.r-project.org/</a>). For the computation the followed extensions must be installed: rgdal, raster and rserve. Rserve must be started before the computation.
</p>

<p>
--------------------
</p>

<p>
This workflow has been created by the Biodiversity Virtual e-Laboratory (BioVeL <a href="http://www.biovel.eu/" rel="nofollow">http://www.biovel.eu/</a>) project. BioVeL is funded by the EU’s Seventh Framework Program, grant no. 283359.
</p>


    </div>


      <h3>
        <img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[This section shows the preview of this version of the Workflow (click on the image to expand)] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
        Preview
      </h3>

      

          <div class="contribution_preview" style="width: 100%;">
            <p style="text-align: center">
              <a href="/workflows/3856/versions/5/previews/full" onclick="window.open(this.href);return false;"><img alt="Medium" src="/workflows/3856/versions/5/previews/medium" /></a>
            </p>
            
                <p style="text-align: right; color: #666666;">
                  <a href="/workflows/3856/versions/5/previews/svg">Download as scalable diagram (SVG)</a>
                </p>
            

            
          </div>
      



      <h3>
        <img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[This section provides options for running this version of the Workflow] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
        Run
      </h3>

      
          
              <div style="margin: 0 0.5em;">
	<h4>
		Run this Workflow in the Taverna Workbench...
	</h4>
	
	<div class="option_box">
		
		<p style="text-align: center;">
			<b>Option 1:</b>
		</p>
		
		<p style="font-size: 93%; text-align: center;">
			Copy and paste this link into File > 'Open workflow location...'<br/>
			<a href="http://www.myexperiment.org/workflows/3856/download?version=5">http://www.myexperiment.org/workflows/3856/download?version=5</a><br/>
			<small>[ <a href="#" onclick="Effect.toggle(&quot;run_taverna_more_box&quot;,'blind',{duration:0.3});; return false;">More Info<img alt="Expand" src="/images/folds/unfold.png?1680607579" style="margin-left: 0.3em; vertical-align: middle;" /></a> ]</small>
		</p>
		
		<div id="run_taverna_more_box" style="display: none;">
			<p style="font-size: 85%; margin-top: 0.5em; text-align: center;">
				Taverna is available from <a href="http://taverna.sourceforge.net/" onclick="window.open(this.href);return false;">http://taverna.sourceforge.net/</a>
			</p>
			
			<p style="text-align: center; margin-top: 0.5em; font-size: 85%;">
				If you are having problems downloading it in Taverna, you may need to provide your username and password in the URL so that Taverna can access the Workflow: <br/>
				
					<b>Replace <font color="#990000">http://</font> in the link above with <font color="#990000">http://yourusername:yourpassword@</font></b>
				
			</p>
		</div>
	
	</div>
</div>


          
      

      <br/>

      <h3>
        <img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[This section shows the internal components of this workflow version] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
        Workflow Components
      </h3>

      
          
              
	    <!-- Authors -->
        <div class="fold">
      <div class="foldTitle">
        <img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[This is the author information extracted from the workflow version] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
        Authors (1)
      </div>
      <div class="foldContent" style="display: none;">
                  <table class="simple">
                          <tr>
                <td>Sarah Bourlat &amp; Sonja Leidenberger &amp; Robert Kulawik</td>
              </tr>
            
          </table>
        
      </div>
    </div>
    
    <!-- Titles -->
        <div class="fold">
      <div class="foldTitle">
        <img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[These are the descriptive titles embedded within the workflow version] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
        Titles (1)
      </div>
      <div class="foldContent" style="display: none;">
                  <table class="simple">
                          <tr>
                <td>BioVeL ESW STACK - ENM Statistical Workflow with raster stack computation</td>
              </tr>
            
          </table>
        
      </div>
    </div>

    <!-- Descriptions -->
        <div class="fold">
      <div class="foldTitle">
        <img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[These are the descriptions embedded within the workflow version] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
        Descriptions (1)
      </div>
      <div class="foldContent" style="display: none;">
                  <table class="simple">
                          <tr>
                <td>The ENM Statistical Stack Workflow (ESW STACK) allows the computation of the extent, intensity and a cummulated potential species distribution through computation of an average sum layer from the input raster layers using the R statistical environment (R Core Team 2013). The sum layer is computed from all input files. e.g from different distribution of species as a mean value from each corresponding raster cell values, coming from the Ecological Niche Modelling (ENM) Workflow (http://www.myexperiment.org/workflows/3355).

The average sum layer computed from each corresponding raster cell values is stored together with all input layers in a multilayer stack file, regardless of the input files’ geographical extent and origin. If the files have a different geographical extent and/or origin, the raster-diff workflow automatically crop them to the same extent and resample the values using the “nearest neighbour” method, resulting in a perfect cell match between the two rasters. The resulting values in the average sum file depends of the value range of the input files and will be normalized to their value range. 

The values of the input layers and the average sum layer are classified into six positive classes. The predicted differences are presented for each species as a heat map, where cells with colors from green to red indicate an increase and from green to blue a decrease of predicted potential for a species. The workflow enables the computation of overall coverage, overall intensity and the difference in intensity or coverage between two raster layers. Overall coverage is computed as the percentage of raster cells with values &gt;0, and overall intensity is computed as the sum of all valued cells divided by the number of raster cells. Summary statistics for the raster layers are also provided: number of raster cells, mean intensity, median, CV, SD, Min value, Max value and number of cells outside the mask.

The workflow contains the computation methods:

- Computation of the average sum layer:
sum_layer = sum(layerstack, na.rm=FALSE)
average_sum_layer = (sum_layer /(nlayers(layerstack)*maxValue)) * maxValue.

- Computation of the overall coverage and intensity
overall_coverage = ((ncell(x)-cellStats(x, &#39;countNA&#39;)-count(x,0))/(ncell(x)-cellStats(x, &#39;countNA&#39;)))*100 
overall_intensity = cellStats(x, sum)/(ncell(x)-cellStats(x, &#39;countNA&#39;)) 

- Computation of the covariance matrix:
The covariance (the measure of how much two random variables change together)matrix will be computed using  standard functions in R: layerStats(layerstack,&quot;cov&quot;,na.rm=TRUE) with excusion of noData values.

- Used standard R functions:
cellStats: https://r-forge.r-project.org/scm/viewvc.php/pkg/raster/R/cellStats.R?view=markup&amp;root=raster
layerStats: https://r-forge.r-project.org/scm/viewvc.php/pkg/raster/R/layerStats.R?view=markup&amp;root=raster

This workflow create a multilayer stack file as output and create PNG thumbnais and PNG overwiews from the input files and the average sum layer. A second multilayer stack can display different pointsets relatet to each PNG

The PNG overview will be created with these values (corresponding to the Geoserver style)
ERDASImagine file:
breakpoints = c(0,1,25,50,75,100)
GeoTIFF file
breakpoints = c(0,2,63,127,190,254)
colors =  c(rgb(1.0,1.0,1.0), rgb(0.996,0.898,0.851), rgb(0.988,0.682,0.569), rgb(0.984,0.416,0.290), rgb(0.871,0.176,0.149), rgb(0.647,0.059,0.082))

Expected as input files are those raster images as a URL reference e.g. output files from openModeller created by an ENM workflow.
*A file upload into the workflow is not possible, only a reference to the input file as URL*

Supported formats are:
- ERDASImagine (.img) files with a value range 0 - 100, noData value 101
- GeoTIFF (.tif) files with a value range 0- 254, noData Value 255

Input files with a different extent will be intersected to a common extent and resampled to each other using the &quot;nearest neighbor&quot; sampling method.

For working with the ESW in a own localhost an R instance should by installed on a own machine (http://cran.r-project.org/). For the computation the followed extensions must be installed: rgdal, raster and rserve. Rserve must be started before the computation.

--------------------

This workflow has been created by the Biodiversity Virtual e-Laboratory (BioVeL http://www.biovel.eu/) project. BioVeL is funded by the EU’s Seventh Framework Program, grant no. 283359.</td>
              </tr>
            
          </table>
        
      </div>
    </div>
        
    <!-- Dependencies -->
        <div class="fold">
      <div class="foldTitle">
        <img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[These are the listed dependencies of the workflow] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
        Dependencies (0)
      </div>
      <div class="foldContent" style="display: none;">
        
          <p class="none_text">None</p>
        
      </div>
    </div>
        
    <!-- Sources -->
        <div class="fold">
      <div class="foldTitle">
        Inputs (4)
      </div>
      <div class="foldContent" style="display: none;">
                  <table class="simple">
            <tr>
              <th>Name</th>
              <th>Description</th>
            </tr>
          
                          <tr>
                <td><b>layerlist</b></td>
                <td>
                  
                    
                      comma separated list of image URLs

e.g.
http://biovel.github.io/esw/sample_data/0ubESU.tif,http://biovel.github.io/esw/sample_data/mXGm7g.tif,http://biovel.github.io/esw/sample_data/NtNUdB.tif,http://biovel.github.io/esw/sample_data/wVM8bF.tif
                      
                    
                  
                </td>
              </tr>
                          <tr>
                <td><b>png_size</b></td>
                <td>
                  
                    
                      size of the PNG overviews and thumbnails in pixel                      
                    
                  
                </td>
              </tr>
                          <tr>
                <td><b>namelist</b></td>
                <td>
                  
                    
                      comma separated list of user layernames for using in in the PNG overlays and the matrices,

e.g.: layername_1,layername_2,layername_3, layername_4

the list must have the same order as the input raster list and the same number of elements

when own user layer names are not needed, please type &quot;none&quot; as input value (this is the standard value), in this case the raster names will be used as layernames                      
                    
                  
                </td>
              </tr>
                          <tr>
                <td><b>occurrence_csv</b></td>
                <td>
                  
                    
                      URL to the CSV File with occurrence points coming from ENM.

If you don&#39;t want to display any points, type  &quot;none&quot; at the begin,

else paste a CSV URL or the content from a CSV or a CSV file as input

It is possible to display different pointsets to the corresponding PNGs. In that case, the point URLs should be entered  comma separated in the same order as the input files. When only one URL is entered, the pointset of that URL will be added to all PNGs.

example:
http://biovel.github.io/esw/sample_data/ED_4.csv,http://biovel.github.io/esw/sample_data/AT_1.csv,http://biovel.github.io/esw/sample_data/CG_3.csv,http://biovel.github.io/esw/sample_data/AM_2.csv
                      
                    
                  
                </td>
              </tr>
            
          </table>
        
      </div>
    </div>
      
    <!-- Processors -->
        <div class="fold">
      <div class="foldTitle">
        Processors (2)
      </div>
      <div class="foldContent" style="display: none;">
                  <table class="simple">
            <tr>
              <th>Name</th>
              <th>Type</th>
              <th>Description</th>
            </tr>
          
                          <tr>
                <td><b>Rshell</b></td>
                <td>rshell</td>
                <td>
                                    <div><h3>Script</h3><pre>##############################################
# FUNCTIONS	        	 	         #
##############################################

## function for getting the correct aspect ratio of the raster in order to be plotted correctly - 15/05/2014
getAsp <- function(rasterObj) {
  if (raster:::.couldBeLonLat(rasterObj, warnings=FALSE)){ 
    ym_rasterObj <- mean(c(ymax(rasterObj), ymin(rasterObj)))
    asp <- 1/cos((ym_rasterObj * pi)/180) 
  }
  else { 
    asp <- 1 
  }
  asp
}

## function for printing the layer stack object received as parameter with the layer names, 
## shape file and occurrences points also passed as parameters
plotLayerStack <- function(layerstackObj,layernamesObj,shapeFileObj,driverObj,pointsSeriesObj) {
  if(driverObj == "GTiff"){
    breakpoints <- c(0,2,63,127,190,254)
  }else{
    breakpoints <- c(0,1,25,50,75,100)
  }
  cols <- c(rgb(1.0,1.0,1.0),rgb(0.996,0.898,0.851),rgb(0.988,0.682,0.569),rgb(0.984,0.416,0.290),rgb(0.871,0.176,0.149),rgb(0.647,0.059,0.082))
  
  for(i in 1:nlayers(layerstackObj)){
    currentLayer <- subset(layerstackObj, i, drop=TRUE)
    plot(currentLayer,main=layernamesObj[i],breaks=breakpoints,col=cols,alpha=0.7,asp=getAsp(currentLayer)) 
    plot(shapeFile, add=TRUE)	
    
    #Print points	  
    if (length(pointsSeriesObj) > 0 ){	
      if(i <= length(pointsSeriesObj)){	
        occurencePoints<-pointsSeriesObj[[i]]
        coordinates(occurencePoints) <- c("decimalLongitude", "decimalLatitude")
        points(coordinates(occurencePoints),col = "black", bg = "yellow",pch = 21)
      }else{
        #summatory layer
        for(j in 1:length(pointsSeriesObj)){
          occurencePoints<-pointsSeriesObj[[j]]
          coordinates(occurencePoints) <- c("decimalLongitude", "decimalLatitude")		
          points(coordinates(occurencePoints),col = "black", bg = "yellow",pch = 21)
        }
      }
	}
  }
}

##############################################
# MAIN BODY OF THE SCRIPT	                  #
##############################################

library(rgdal)
library(raster)

size <- as.integer(png_size)

#--------------------------------------------------------------
#layernames names for the layerstack for covariance first
#--------------------------------------------------------------
layernames <- c()
nlistOK <- FALSE
checkNames <- FALSE
if(!isTRUE(!is.na(pmatch('none',namelist)))){  
  if(!is.na(pmatch(',',namelist))){
    stop("The layer namelist is not comma separated or has only one entry")
  }else {
    layernames <- gsub(" ","",namelist,fixed=TRUE)
    namesplit <- strsplit(layernames, ",")[[1]];
    layernames <- c(namesplit)
    checkNames <- TRUE
  }
}

llist <- gsub(" ","",layerlist,fixed=TRUE)
dest <- as.numeric(Sys.time());
csv_name <- paste(dest, 'csv', sep="")

if(!is.na(pmatch(',',llist))){
  stop("The input filelist is not comma separated or has only one entry")
}

#--------------------------------------------------------------
#create Layerlist and check if it has the same length as the layerNameList
#--------------------------------------------------------------
spl <- strsplit(llist, ",")[[1]];

if(checkNames){
  if (length(spl) != length(namesplit)){
    stop("The input filelist has a different number of entrys to the list of raster layers")  
  } else {
    nlistOK <- TRUE  
  }
}

#--------------------------------------------------------------
#download and read the CSV occurence points
#--------------------------------------------------------------
pointsSeries <- list()
if(!is.na(pmatch('http',csv_string))){  
  #check if one or more files are referenced
  pointFiles <- strsplit(csv_string, ",")[[1]];
  if (length(pointFiles)> 1 ){
    #check if layerlist has the same length as the layerNameList
    if (length(spl) != length(pointFiles)){
      stop("The input csv_list has a different number of entrys to the list of raster layers")	
    } else {
      for(i in 1:length(pointFiles)){
        download.file(url=pointFiles[i], destfile=csv_name, method = "auto", quiet=FALSE)
        pointsSeries[[length(pointsSeries)+1]] <- read.csv(csv_name, sep=",", header = T)
      }
    }
  } else {
    download.file(url=csv_string, destfile=csv_name, method = "auto", quiet=FALSE)
    pointsSeries[[length(pointsSeries)+1]] <- read.csv(csv_name, sep=",", header = T)
  }
} else if(!is.na(pmatch('none',csv_string))){
  pointsSeries <- list()
} else {
  con <- textConnection(csv_string)
  pointsSeries[[length(pointsSeries)+1]]<-read.csv(con, sep=",", header = T)
  close(con)
}


#--------------------------------------------------------------
#download the first layer
#--------------------------------------------------------------
layer <- spl[1]
lastst <- strsplit(spl[1], "/")[[1]];
destname <- paste(dest,"_",lastst[length(lastst)], sep="")

if(is.na(pmatch('http',layer))){
  stop("the Layer URL has to start with 'http'")
}

if(isTRUE(toString(Sys.info()['sysname'])=="Windows")){	
  # windows download
  download.file(url=layer, destfile=destname, method = "internal", mode="wb", quiet=FALSE)
} else {
  #linux-mac download
  download.file(url=layer, destfile=destname, method = "auto", quiet=FALSE)
}

x <- readGDAL(destname)
rx <- raster(x)

#layernames names for the layerstack for covariance first
if(!nlistOK){
  layernames <- append(layernames, lastst[length(lastst)])
}

#--------------------------------------------------------------
#read rastervalues values from GDALinfo
#--------------------------------------------------------------
#GDALinfo
gi1 <- GDALinfo(destname)
#get the datatype from GDALinfo
dataType <- toString(attributes(gi1)$df[,1])
#STOP if the data type is not Byte
if(!isTRUE(dataType == "Byte")){
  stop("one of the input files is not a 'Byte' datatype. Currently are only 'Byte' datatypes allowed")	
}
#get GDAL raster driver
driver <- attributes(gi1)$driver# <- HFA or GTiff
#get noData value from GDALinfo
novalue <- attributes(gi1)$df[,3]
NAvalue(rx) <- novalue

layerstack <-stack(rx)

#--------------------------------------------------------------
# Download the rest of the layers checking that have the same 
# format as the first layer. Also cropping layers when necessary
#--------------------------------------------------------------
for(i in 2:length(spl)){
  layer <- spl[i]
  lastst <- strsplit(spl[i], "/")[[1]];
  if(!nlistOK){
    layernames <- append(layernames, lastst[length(lastst)])
  }
  destname <- paste(dest,"_",lastst[length(lastst)], sep="")
  
  if(is.na(pmatch('http',layer))){
    next
  }
  
  if(isTRUE(toString(Sys.info()['sysname'])=="Windows")){	
    # windows download
    download.file(url=layer, destfile=destname, method = "internal", mode="wb", quiet=FALSE)
  } else {
    #linux-mac download
    download.file(url=layer, destfile=destname, method = "auto", quiet=FALSE)
  }
  
  x <- readGDAL(destname)
  rx <- raster(x)
  
  #read rastervalues values from GDALinfo
  #GDALinfo
  gi1 <- GDALinfo(destname)
  #get the datatype from GDALinfo
  dataType <- toString(attributes(gi1)$df[,1])
  #STOP if the data type is not Byte
  if(!isTRUE(dataType == "Byte")){
    stop("one of the input files is not a 'Byte' datatype. Currently are only 'Byte' datatypes allowed")	
  }
  #get GDAL raster driver
  driver1 <- attributes(gi1)$driver# <- HFA or GTiff
  if(driver != driver1){
    stop("different file formats. Please use the same format HDF or GTiff for all files")
  }
  #get noData value from GDALinfo
  novalue <- attributes(gi1)$df[,3]
  NAvalue(rx) <- novalue
  
  if(!isTRUE((origin(rx)==origin(layerstack))&&(extent(rx)==extent(layerstack)) )){
    cropped <- TRUE
    is <- intersect(rx, layerstack)
    rx <-crop (rx, is)
    ry <-crop (layerstack, is)
    #resample rx to ry to get the same origin
    rx <- resample(rx, layerstack, method="ngb")
  }
  
  layerstack <-stack(layerstack, rx)
}

#--------------------------------------------------------------
#download and unzip the shapefile
#--------------------------------------------------------------
tmpDir <- tempdir()
shapeDir <- paste(tmpDir,"tdwg_level_4.shp",sep='/')
if(!isTRUE(file.exists(shapeDir))){
  shapeDownload <- "file download"
  #url <- "http://biovel.iais.fraunhofer.de/biostif/data/tdwg_level_4.zip"
  url <- "http://biovel.github.io/esw/tdwg_level_4.zip"
  file <- basename(url)
  download.file(url, file)
  unzip(file, exdir = tmpDir )	
}
shapeFile <- readOGR(tmpDir,"tdwg_level_4")


#--------------------------------------------------------------
#covariance
#--------------------------------------------------------------
names(layerstack) <- layernames
covariance_table <- layerStats(layerstack,"cov",na.rm=TRUE)
write.table(covariance_table, file=covariance, sep = ",", quote = FALSE, col.names=NA)

#--------------------------------------------------------------
#pearson
#--------------------------------------------------------------
#pearson_table <- layerStats(layerstack,"pearson",na.rm=TRUE)
#write.table(pearson_table, file=pearson, sep = ",", quote = FALSE, col.names=NA)
# output port when needed again = pearson as text-file

#--------------------------------------------------------------
#summary file with raster statistics
#--------------------------------------------------------------
stacksummary <- paste("Layername","ncell","mean","median","cv","sd","min","max","countNA", sep=",")
for(i in 1:nlayers(layerstack)){
  cuRast <- raster(layerstack, layer=i)  
  ilayer <- paste(layernames[i],ncell(cuRast),cellStats(cuRast, 'mean'),cellStats(cuRast, median),cellStats(cuRast,cv),cellStats(cuRast, 'sd'),cellStats(cuRast,'min'),cellStats(cuRast, 'max'),cellStats(cuRast, 'countNA'),sep=",")
  stacksummary <- paste(stacksummary,ilayer,sep="\n")
}

#--------------------------------------------------------------
#compute overall statistics
#--------------------------------------------------------------
overall_stat <- paste("Layername","Overall_coverage","Overall_intensity", sep = ",")
for(i in 1:nlayers(layerstack)){
  cuRast <- raster(layerstack, layer=i)
  
  count_zero <- 0
  if(isTRUE(toString(version["major"][1]) == 2)){
    count_zero <- count(cuRast,0)
  } else {
    count_zero <- as.numeric(toString(freq(cuRast)[1,"count"]))
  }
  
  overall_cover <- ((ncell(cuRast)-cellStats(cuRast, 'countNA')-count_zero)/(ncell(cuRast)-cellStats(cuRast, 'countNA')))*100
  overall_intensity <- (cellStats(cuRast, sum)/(ncell(cuRast)-cellStats(cuRast, 'countNA')))
  ilayer <- paste(layernames[i],overall_cover,overall_intensity,sep=",")
  overall_stat <- paste(overall_stat,ilayer,sep="\n")
}

sos <- sum(layerstack, na.rm=FALSE)
maxValue <- tempfile()
if(driver == "GTiff"){
  maxValue <- 254
} else {
  maxValue <- 100
}
sos <- (sos/(nlayers(layerstack)*maxValue))*maxValue
count_zero <- 0
if(isTRUE(toString(version["major"][1]) == 2)){
  count_zero <- count(sos,0)
} else {
  count_zero <- as.numeric(toString(freq(sos)[1,"count"]))
}

overall_cover <- ((ncell(sos)-cellStats(sos, 'countNA')-count_zero)/(ncell(sos)-cellStats(sos, 'countNA')))*100
overall_intensity <- (cellStats(sos, sum)/(ncell(sos)-cellStats(sos, 'countNA')))
sl <- paste("average_sumlayer",overall_cover,overall_intensity,sep=",")
overall_stat <- paste(overall_stat,sl,sep="\n")
ilayer <- paste("average_sumlayer",ncell(sos),cellStats(sos, 'mean'),cellStats(sos, median),cellStats(sos,cv),cellStats(sos, 'sd'),cellStats(sos,'min'),cellStats(sos, 'max'),cellStats(sos, 'countNA'),sep=",")
stacksummary <- paste(stacksummary,ilayer,sep="\n")
layerstack <-stack(layerstack, sos)
layernames <- append(layernames, "average_sumlayer")


#--------------------------------------------------------------
#create pngs
#--------------------------------------------------------------
numColumnsOverView <- ceiling(sqrt(nlayers(layerstack)))
numRowsOverView <- ceiling(nlayers(layerstack)/numColumnsOverView)
weightOverview <- size
heightOverview <- ceiling((size/numColumnsOverView)*numRowsOverView)

png(filename=PNGoverview,width=weightOverview,height=heightOverview,bg="white")
par(mfrow=c(numRowsOverView,numColumnsOverView),mar=c(5.1,2.1,2.1,5.1))
plotLayerStack(layerstack,layernames,shapeFile,driver,pointsSeries)
dev.off()

png(filename=stackPNG,height=size*nlayers(layerstack), width=size,bg="white")
par(mfrow=c(nlayers(layerstack),1))
plotLayerStack(layerstack,layernames,shapeFile,driver,pointsSeries)
dev.off()

#--------------------------------------------------------------
#store stack
#--------------------------------------------------------------
if(driver == "HFA"){
  writeRaster(layerstack, filename='stackImg.img', format="HFA", overwrite=TRUE)
  file.rename('stackImg.img','stackImg.png')
} else {
  writeRaster(layerstack, filename='stackImg.tif', format="GTiff", overwrite=TRUE)
  file.rename('stackImg.tif','stackImg.png')
}</pre></div><div><h3>R Server</h3>localhost:6311</div>                </td>
              </tr>
                          <tr>
                <td><b>parse_csv</b></td>
                <td>beanshell</td>
                <td>
                                    <div><h3>Script</h3><pre>import java.io.StringReader;
import java.io.BufferedReader;

BufferedReader reader = new BufferedReader(new StringReader(csv_content));

    String temp = null;
    StringBuffer text = new StringBuffer();
    while ((temp = reader.readLine()) != null) {
            text.append(temp + "\n");

    };

String csv_string = text.toString().substring(0,text.toString().length()-1);
</pre></div>                </td>
              </tr>
            
          </table>
        
      </div>
    </div>
    
    <!-- Beanshells -->
        <div class="fold">
      <div class="foldTitle">
        Beanshells (1)
      </div>
      <div class="foldContent" style="display: none;">
                  <table class="simple">
            <tr>
              <th>Name</th>
              <th>Description</th>
              <th>Inputs</th>
              <th>Outputs</th>
            </tr>
          
                          <tr>
                <td><b>parse_csv</b></td>
                <td></td>
                <td>
                  
                    
                      csv_content                      
                    
                  
                </td>
                <td>
                  
                    
                      csv_string                      
                    
                  
                </td>
              </tr>
            
          </table>
        
      </div>
    </div>
    
    <!-- Sinks -->
        <div class="fold">
      <div class="foldTitle">
        Outputs (6)
      </div>
      <div class="foldContent" style="display: none;">
                  <table class="simple">
            <tr>
              <th>Name</th>
              <th>Description</th>
            </tr>
          
                          <tr>
                <td><b>stackPNG</b></td>
                <td>
                  
                    
                      PNG overview of the input current layer with a background country borders based on the TDWG level4 layer 

Used color ramp:
ERDASImagine file:
breakpoints = (0,1,25,50,75,100)
GeoTIFF file
breakpoints = c(0,2,63,127,190,254)
colors = c(rgb(1.0,1.0,1.0),rgb(0.996,0.898,0.851),rgb(0.988,0.682,0.569),rgb(0.984,0.416,0.290),rgb(0.871,0.176,0.149),rgb(0.647,0.059,0.082))                      
                    
                  
                </td>
              </tr>
                          <tr>
                <td><b>covariance</b></td>
                <td>
                  
                    
                      computed covariance matrix from the input raster layers.                      
                    
                  
                </td>
              </tr>
                          <tr>
                <td><b>rastersummary</b></td>
                <td>
                  
                    
                      This file contains the summary for the current, prediction and the difference layer:
- Number of cells (ncell),
- Mean and median value (mean,median)
- Coefficient of variation (cv)
- Standard deviation (sd)
- current minimal and maximal values (min,max)
- Number of noData values in file (countNA)                      
                    
                  
                </td>
              </tr>
                          <tr>
                <td><b>overall_statistics</b></td>
                <td>
                  
                    
                      This file contains the changes computation in the submitted files:
Overall coverage in the input raster files and the average sum layer
overall_coverage = ((ncell(x)-cellStats(x, &#39;countNA&#39;)-count(x,0))/(ncell(x)-cellStats(x, &#39;countNA&#39;)))*100 

Overall intensity absolute and in percent in the raster files and the average sum layer
overall_intensity = (cellStats(x, sum)/(ncell(x)-cellStats(x, &#39;countNA&#39;)))                      
                    
                  
                </td>
              </tr>
                          <tr>
                <td><b>stackImg</b></td>
                <td>
                  
                    
                      stack multilayer file as GeoTIFF or ERDASImagine file contains all input raster layers and the computed average sum layer                      
                    
                  
                </td>
              </tr>
                          <tr>
                <td><b>PNGoverview</b></td>
                <td>
                  
                    
                      PNG overview of the input current layer with a background country borders based on the TDWG level4 layer 

Used color ramp:
ERDASImagine file:
breakpoints = (0,1,25,50,75,100)
GeoTIFF file
breakpoints = c(0,2,63,127,190,254)
colors = c(rgb(1.0,1.0,1.0),rgb(0.996,0.898,0.851),rgb(0.988,0.682,0.569),rgb(0.984,0.416,0.290),rgb(0.871,0.176,0.149),rgb(0.647,0.059,0.082))                      
                    
                  
                </td>
              </tr>
            
          </table>
        
      </div>
    </div>
    
    <!-- Datalinks -->
        <div class="fold">
      <div class="foldTitle">
        Datalinks (11)
      </div>
      <div class="foldContent" style="display: none;">
                  <table class="simple">
            <tr>
              <th>Source</th>
              <th>Sink</th>
            </tr>
          
                          <tr>
                <td>layerlist</td>
                <td>Rshell:layerlist</td>
              </tr>
                          <tr>
                <td>png_size</td>
                <td>Rshell:png_size</td>
              </tr>
                          <tr>
                <td>namelist</td>
                <td>Rshell:namelist</td>
              </tr>
                          <tr>
                <td>parse_csv:csv_string</td>
                <td>Rshell:csv_string</td>
              </tr>
                          <tr>
                <td>occurrence_csv</td>
                <td>parse_csv:csv_content</td>
              </tr>
                          <tr>
                <td>Rshell:stackPNG</td>
                <td>stackPNG</td>
              </tr>
                          <tr>
                <td>Rshell:covariance</td>
                <td>covariance</td>
              </tr>
                          <tr>
                <td>Rshell:stacksummary</td>
                <td>rastersummary</td>
              </tr>
                          <tr>
                <td>Rshell:overall_stat</td>
                <td>overall_statistics</td>
              </tr>
                          <tr>
                <td>Rshell:stackImg</td>
                <td>stackImg</td>
              </tr>
                          <tr>
                <td>Rshell:PNGoverview</td>
                <td>PNGoverview</td>
              </tr>
            
          </table>
        
      </div>
    </div>
    
    <!-- Coordinations -->
        <div class="fold">
      <div class="foldTitle">
        Coordinations (0)
      </div>
      <div class="foldContent" style="display: none;">
        
          <p class="none_text">None</p>
        
      </div>
    </div>
  
    

          
      
    </div>

  </div>

</div>

<div class="contribution_right_box">
  <div class="contribution_section_box" style= "font-size: 100%; padding: 0.7em 0.9em; font-weight: bold;">
    <p><img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[The type of workflow system that this Workflow is designed for.] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" /> Workflow Type</p>
    <p><a href="/content_types/2">Taverna 2</a></p>
  </div>

  <div class="contribution_section_box">
	<p class="heading">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[The Uploader is the person who uploaded/created this Workflow on myExperiment, and who manages it on myExperiment.] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		Uploader
	</p>
	<p>
		<center>
			<div class="avatar" style="width: 66px">
  <a href="/users/20320"><img alt="Avatar" class="framed" height="60" src="/images/avatar.png?1680607579" title="Robert Kulawik" width="60" /></a>
  
	<span style="display:block;margin-top:2px;text-align:center;">
		
			<img alt="De" src="/images/famfamfam_flags/de.png?1680607579" style="vertical-align:middle; margin-right: 0.3em;" title="header=[] body=[&lt;b&gt;Location: &lt;/b&gt;Sankt Augustin, Germany] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		

    
			<a href="/users/20320" title="header=[] body=[Robert Kulawik] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]">Robert Kulawik</a>
		

    
	</span>
  
</div>

		</center>
	</p>
</div>


  

  

<div class="contribution_section_box">
	<p class="heading">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[This specifies what rights users have when they download and use this Workflow.] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		License
		<a name="license"></a>
	</p>

  

    
    
    
    
    


    

    <!--

    <rdf:RDF xmlns="http://creativecommons.org/ns#"
        xmlns:dc="http://purl.org/dc/elements/1.1/"
        xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
    <Work rdf:about="">
       <dc:title>BioVeL ESW STACK - ENM Statistical Workflow with raster stack computation</dc:title>
       <dc:date>2013-10-13 12:27:09 UTC</dc:date>
       <dc:description>&lt;p&gt;
The ENM Statistical Stack Workflow (ESW STACK) allows the computation of the extent, intensity and a cummulated potential species distribution through computation of an average sum layer from the input raster layers using the R statistical environment (R Core Team 2013). The sum layer is computed from all input files. e.g from different distribution of species as a mean value from each corresponding raster cell values, coming from the Ecological Niche Modelling (ENM) Workflow (&lt;a href=&quot;http://www.myexperiment.org/workflows/3355&quot; rel=&quot;nofollow&quot;&gt;http://www.myexperiment.org/workflows/3355&lt;/a&gt;).
&lt;/p&gt;

&lt;p&gt;
The average sum layer computed from each corresponding raster cell values is stored together with all input layers in a multilayer stack file, regardless of the input files’ geographical extent and origin. If the files have a different geographical extent and/or origin, the raster-diff workflow automatically crop them to the same extent and resample the values using the “nearest neighbour” method, resulting in a perfect cell match between the two rasters. The resulting values in the average sum file depends of the value range of the input files and will be normalized to their value range. 
&lt;/p&gt;

&lt;p&gt;
The values of the input layers and the average sum layer are classified into six positive classes. The predicted differences are presented for each species as a heat map, where cells with colors from green to red indicate an increase and from green to blue a decrease of predicted potential for a species. The workflow enables the computation of overall coverage, overall intensity and the difference in intensity or coverage between two raster layers. Overall coverage is computed as the percentage of raster cells with values &gt;0, and overall intensity is computed as the sum of all valued cells divided by the number of raster cells. Summary statistics for the raster layers are also provided: number of raster cells, mean intensity, median, CV, SD, Min value, Max value and number of cells outside the mask.
&lt;/p&gt;

&lt;p&gt;
The workflow contains the computation methods:
&lt;/p&gt;

&lt;p&gt;
- Computation of the average sum layer:
&lt;/p&gt;

&lt;p&gt;
sum_layer = sum(layerstack, na.rm=FALSE)
average_sum_layer = (sum_layer /(nlayers(layerstack)*maxValue)) * maxValue.
&lt;/p&gt;

&lt;p&gt;
- Computation of the overall coverage and intensity
overall_coverage = ((ncell(x)-cellStats(x, &#39;countNA&#39;)-count(x,0))/(ncell(x)-cellStats(x, &#39;countNA&#39;)))*100 
overall_intensity = cellStats(x, sum)/(ncell(x)-cellStats(x, &#39;countNA&#39;)) 
&lt;/p&gt;

&lt;p&gt;
- Computation of the covariance matrix:
&lt;/p&gt;

&lt;p&gt;
The covariance (the measure of how much two random variables change together)matrix will be computed using  standard functions in R: layerStats(layerstack,&quot;cov&quot;,na.rm=TRUE) with excusion of noData values.
&lt;/p&gt;

&lt;p&gt;
- Used standard R functions:
&lt;/p&gt;

&lt;p&gt;
cellStats: &lt;a href=&quot;https://r-forge.r-project.org/scm/viewvc.php/pkg/raster/R/cellStats.R?view=markup&amp;amp;root=raster&quot; rel=&quot;nofollow&quot;&gt;https://r-forge.r-project.org/scm/viewvc.php/pkg/raster/R/cellStats.R?view=markup&amp;amp;root=raster&lt;/a&gt;
layerStats: &lt;a href=&quot;https://r-forge.r-project.org/scm/viewvc.php/pkg/raster/R/layerStats.R?view=markup&amp;amp;root=raster&quot; rel=&quot;nofollow&quot;&gt;https://r-forge.r-project.org/scm/viewvc.php/pkg/raster/R/layerStats.R?view=markup&amp;amp;root=raster&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
This workflow create a multilayer stack file as output and create PNG thumbnais and PNG overwiews from the input files and the average sum layer. A second multilayer stack can display different pointsets relatet to each PNG
&lt;/p&gt;

&lt;p&gt;
The PNG overview will be created with these values (corresponding to the Geoserver style)
ERDASImagine file:
&lt;/p&gt;

&lt;p&gt;
breakpoints = c(0,1,25,50,75,100)
GeoTIFF file
breakpoints = c(0,2,63,127,190,254)
colors =  c(rgb(1.0,1.0,1.0), rgb(0.996,0.898,0.851), rgb(0.988,0.682,0.569), rgb(0.984,0.416,0.290), rgb(0.871,0.176,0.149), rgb(0.647,0.059,0.082))
&lt;/p&gt;

&lt;p&gt;
Expected as input files are those raster images as a URL reference e.g. output files from openModeller created by an ENM workflow.
*A file upload into the workflow is not possible, only a reference to the input file as URL*
&lt;/p&gt;

&lt;p&gt;
Supported formats are:
&lt;/p&gt;

&lt;p&gt;
- ERDASImagine (.img) files with a value range 0 - 100, noData value 101
- GeoTIFF (.tif) files with a value range 0- 254, noData Value 255
&lt;/p&gt;

&lt;p&gt;
Input files with a different extent will be intersected to a common extent and resampled to each other using the &quot;nearest neighbor&quot; sampling method.
&lt;/p&gt;

&lt;p&gt;
For working with the ESW in a own localhost an R instance should by installed on a own machine (&lt;a href=&quot;http://cran.r-project.org/&quot; rel=&quot;nofollow&quot;&gt;http://cran.r-project.org/&lt;/a&gt;). For the computation the followed extensions must be installed: rgdal, raster and rserve. Rserve must be started before the computation.
&lt;/p&gt;

&lt;p&gt;
--------------------
&lt;/p&gt;

&lt;p&gt;
This workflow has been created by the Biodiversity Virtual e-Laboratory (BioVeL &lt;a href=&quot;http://www.biovel.eu/&quot; rel=&quot;nofollow&quot;&gt;http://www.biovel.eu/&lt;/a&gt;) project. BioVeL is funded by the EU’s Seventh Framework Program, grant no. 283359.
&lt;/p&gt;

</dc:description>
       <dc:creator><Agent>
          <dc:title><a href="/users/20320" title="header=[] body=[Robert Kulawik] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]">Robert Kulawik</a></dc:title>
       </Agent></dc:creator>
       <dc:rights><Agent>
          <dc:title><a href="/users/20320" title="header=[] body=[Robert Kulawik] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]">Robert Kulawik</a></dc:title>
       </Agent></dc:rights>
       <dc:type rdf:resource="http://purl.org/dc/dcmitype/Data" />
       <dc:source rdf:resource="http://www.myexperiment.org/workflows/3856.html"/>
       <license rdf:resource="http://creativecommons.org/licenses/by-sa/3.0/" />
    </Work>

    <License rdf:about="http://creativecommons.org/licenses/by-sa/3.0/">
      <permits rdf:resource="http://creativecommons.org/ns#Reproduction" />  <permits rdf:resource="http://creativecommons.org/ns#Distribution" />  <requires rdf:resource="http://creativecommons.org/ns#Notice" />  <requires rdf:resource="http://creativecommons.org/ns#Attribution" />  <permits rdf:resource="http://creativecommons.org/ns#DerivativeWorks" />  <requires rdf:resource="http://creativecommons.org/ns#ShareAlike" />
    </License>

    </rdf:RDF>

    -->

  

  <div class="contribution_currentlicense">
    <p>
      
        All versions of this Workflow are
      
      
        licensed under: <br/><br/><a rel="Copyright" href="/licenses/2" title="Creative Commons Attribution-Share Alike 3.0 Unported License"><img src="/images/by-sa.png" /></a>
      
    </p>
  </div>
	
</div>


  <script type="text/javascript">
    function showVersion(form) {
        var url = $("resource_versions").value;
        location.href = url;
        form.submit
    }
</script>
<style>
  .version_selection {
      font-size:smaller;
      text-align: center;
  }
</style>

<div class="contribution_section_box">
  <p class="heading">
    <img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[This box shows version 5 for this entry] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />    <span>Version 5 (latest)</span>
    <span class="count_text">(of 5)</span>
  </p>
  
      <form onsubmit="showVersion(this); return false;" style="text-align: right;">
        <p class="version_selection">
        View version:
        <select id="resource_versions" onchange="showVersion(this.form)">
          
              <option value="/workflows/3856/versions/5" selected>
                5 (latest)
              </option>
          
              <option value="/workflows/3856/versions/4" >
                4 
              </option>
          
              <option value="/workflows/3856/versions/3" >
                3 
              </option>
          
              <option value="/workflows/3856/versions/2" >
                2 
              </option>
          
              <option value="/workflows/3856/versions/1" >
                1 (earliest)
              </option>
          
        </select>
        </p>
      </form>
  
</div>

  <div class="contribution_section_box">
	
	<p class="heading" style="margin-bottom: 0; padding-bottom: 0;">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[Which people/groups get the credit for this Workflow?] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		Credits <span class="count_text">(1)</span>
		<a name="credits"></a>
	</p>
	<span style="font-size: 85%; color: #666666; display: block; padding: 0.3em 0.5em 0 0.5em; margin: 0; line-height: 1em;">(People/Groups)</span>
	
		<div style="font-size: 85%;">
			<ul class="items">
				
					<li>
						
							
								<span class="icon"><img alt="User" src="/images/famfamfam_silk/user.png?1680607579" /> </span> 
							
							<a href="/users/20320" title="header=[] body=[Robert Kulawik] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]">Robert Kulawik</a>
						
					</li>
				
			</ul>
		</div>
	
	
	
	<p class="heading" style="margin-bottom: 0; padding-bottom: 0;">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[What other Workflows/Files is this one based on?] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		Attributions <span class="count_text">(0)</span>
		<a name="attributions"></a>
	</p>
	<span style="font-size: 85%; color: #666666; display: block; padding: 0.3em 0.5em 0 0.5em; margin: 0; line-height: 1em;">(Workflows/Files)</span>
	
		<p class="none_text">None</p>
	
	
	
	
</div>


  


  <div class="contribution_section_box">
	<p class="heading">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[The tags for this Workflow entry.&lt;br/&gt;Note(1): if this Workflow has many versions, the tags apply to ALL versions in this entry.&lt;br/&gt;Note(2): the size of the tags show how popular they are on myExperiment.] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		Tags <span id="tags_box_header_tag_count_span" class="count_text">(11)</span>
		<a name="tags"></a>
	</p>

	<script type="text/javascript">
  function showAllTags() {
    Element.show('all_tags');
	  Element.hide('user_tags');
	  return false;
  }
  
  function showUsersTags() {
  	Element.hide('all_tags');
	  Element.show('user_tags');
	  return false;
  }
	
	function flip_tags_mode()
	{
		if( $('toggle_tags_mode').checked )
		  showUsersTags();
	  else
		  showAllTags();
	}
</script>

<div id="tags_inner_box">
	
		<div class="box_currentuser_specific" style="padding: 0.3em 0.2em; margin: 0.6em 0.4em;">
		  <label for="toggle_tags_mode" style="font-size: 85%; font-weight: bold;"><input id="toggle_tags_mode" name="toggle_tags_mode" onclick="flip_tags_mode();" style="margin-right: 0.3em;" type="checkbox" value="1" />Uploader tags</label>
		</div>
		<div id="all_tags">
			
				<div class="hTagcloud">
  <ul class="popularity">
    <li><a href='/tags/3017' class='popular'>average</a></li>
<li> | </li>
    <li><a href='/tags/2991' class='vvvv-popular'>biovel</a></li>
<li> | </li>
    <li><a href='/tags/4395' class='popular'>covariance</a></li>
<li> | </li>
    <li><a href='/tags/3160' class='popular'>ecological niche modelling</a></li>
<li> | </li>
    <li><a href='/tags/2615' class='popular'>heatmap</a></li>
<li> | </li>
    <li><a href='/tags/4393' class='popular'>occurrence data</a></li>
<li> | </li>
    <li><a href='/tags/4396' class='popular'>png</a></li>
<li> | </li>
    <li><a href='/tags/750' class='v-popular'>r</a></li>
<li> | </li>
    <li><a href='/tags/4389' class='popular'>resampling</a></li>
<li> | </li>
    <li><a href='/tags/721' class='popular'>species</a></li>
<li> | </li>
    <li><a href='/tags/1231' class='popular'>statistics</a></li>
  </ul>
</div>

			
		</div>
		<div id="user_tags"  style="display: none;">
			
    		<p class="none_text">None</p>
			
		</div>
	
</div>
	
	
	
	
		<p><small><b><a href="/session/new">Log in</a></b> to add Tags</small></p>
	
</div>


  
<div class="contribution_section_box">
	<p class="heading">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[All the Groups that this item has been shared with] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		Shared with Groups <span class="count_text">(2)</span>
	</p>
	
		<div style="font-size: 85%;">
			<ul class="items">
				
					<li>
						<span class="icon"><img alt="Network-member" src="/images/famfamfam_silk/group.png?1680607579" /> </span>
						<a href="/groups/1013">BioVeL internal</a>
					</li>
				
					<li>
						<span class="icon"><img alt="Network-member" src="/images/famfamfam_silk/group.png?1680607579" /> </span>
						<a href="/groups/643">BioVeL</a>
					</li>
				
			</ul>
		</div>
	
</div>

  <div class="contribution_section_box" id="in_packs_box">
  
	<p class="heading">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[All the Packs that this item (or versions of this item [[if available]]) is referred to in] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		Featured In Packs  <span class="count_text">(0)</span>
		<a name="featured_in_packs"></a>
	</p>
	
		<p class="none_text">None</p>
	
	
	
		<p><small><b><a href="/session/new">Log in</a></b> to add to one of your Packs</small></p>
	
</div>


  <div class="contribution_section_box">
	
	<p class="heading" style="margin-bottom: 0; padding-bottom: 0;">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[Shows files and workflows that have attributed this Workflow.] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		Attributed By <span class="count_text">(0)</span>
	  <a name="attributed_by"></a>
	</p>
	<span style="font-size: 85%; color: #666666; display: block; padding: 0.3em 0.5em 0 0.5em; margin: 0; line-height: 1em;">(Workflows/Files)</span>
	
		
		<p class="none_text">None</p>
	
	
</div>


  
<div class="contribution_section_box">
	<p class="heading">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[The users who have added this Workflow to their favourites] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		Favourited By <font class="count_text">(0)</font>
		<a name="favourited_by"></a>
	</p>
	
	
		<p class="none_text">No one</p>
	
	
	
</div>

  

<div class="contribution_section_box">
	<p class="heading" style="margin-bottom: 0.3em;">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[Viewing / download counts are grand totals for this Workflow.&lt;br/&gt;Click &#39;see breakdown&#39; to view details.] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		Statistics
	</p>
	
	<div class="stats_box"> 
		<p style="font-size: 85%;">
  4204 viewings
</p>

	<p style="font-size: 85%;">
	  1394 downloads
	</p>

<p style="margin-top: 0.2em;">
	<small>[ <a href="/workflows/3856/statistics">see breakdown</a> ]</small>
</p>
		
		<div class="fold" style="padding-top: 0.6em;">
			<div class="foldTitle">More</div>
			<div class="foldContent" style="display: none; text-align: left;">
				
					<p>
						<a href="#credits">1 credit</a> <!-- won't work for type=='group'; needs anchor called '#group_creditations' -->
					</p>
					
					<p>
						<a href="#attributions">0 attributions</a>
					</p>
				
				
				
					<p>
			      <a href="#tags">11 tags</a>
			    </p>
				
				
				
					<p>
			      <a href="#favourited_by">0 favourites</a>
			    </p>
				

				
					<p>
						<a href="#citations">0 citations</a>
			    </p>
				
				
				
					<p>
			      <a href="#reviews">0 reviews</a>
			    </p>
				
				
				
			    <p>
			    	<a href="#comments">0 comments</a>
			    </p>
				
			</div>
		</div>
		
		
		
		
	</div>
</div>

</div>

<div class="clearer">&nbsp;</div>

<!-- BEGIN tabs -->

<br/>

<div id="tabsContainer" class="tabsContainer"></div>

<div class="tabContainer">
  <div class="tabTitle">Citations (0)</div>
  <div class="tabContent">

    <a name="citations"></a>
    
      <p><i>None</i></p>
    
		
		<br/>

    

  </div>
</div>


<div class="tabContainer">
  <div class="tabTitle">Version History</div>
  <div class="tabContent">
    <a name="version_history"></a>
    <p>In chronological order:</p>

<ol class="version_history">
  
    <li>
      <div class="title">
        <a href="/workflows/3856/versions/1">BioVeL ESW STACK - ENM Statistical Workflow with raster stack computation</a>
      </div>
      <div class="metadata">

        <p>
          Created
          
            by <a href="/users/20320" title="header=[] body=[Robert Kulawik] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]">Robert Kulawik</a>
          
          on Sunday 13 October 2013 12:27:09 (UTC)
        </p>

        

        
      </div>
    </li>
  
    <li>
      <div class="title">
        <a href="/workflows/3856/versions/2">BioVeL ESW STACK - ENM Statistical Workflow with raster stack computation</a>
      </div>
      <div class="metadata">

        <p>
          Created
          
            by <a href="/users/20320" title="header=[] body=[Robert Kulawik] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]">Robert Kulawik</a>
          
          on Monday 12 May 2014 13:49:57 (UTC)
        </p>

        

        
          <p>
            <div>Revision comment:</div>
            <div class="comment">
              <p>Changes:<br />- pearson matrix is removed.<br />- a second PNG STACK is added with the opportunity to display different piontsets</p><p>&nbsp;</p>
            </div>
          </p>
        
      </div>
    </li>
  
    <li>
      <div class="title">
        <a href="/workflows/3856/versions/3">BioVeL ESW STACK - ENM Statistical Workflow with raster stack computation</a>
      </div>
      <div class="metadata">

        <p>
          Created
          
            by <a href="/users/20320" title="header=[] body=[Robert Kulawik] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]">Robert Kulawik</a>
          
          on Wednesday 14 May 2014 15:37:55 (UTC)
        </p>

        

        
          <p>
            <div>Revision comment:</div>
            <div class="comment">
              <p>Change example data</p>
            </div>
          </p>
        
      </div>
    </li>
  
    <li>
      <div class="title">
        <a href="/workflows/3856/versions/4">BioVeL ESW STACK - ENM Statistical Workflow with raster stack computation</a>
      </div>
      <div class="metadata">

        <p>
          Created
          
            by <a href="/users/20320" title="header=[] body=[Robert Kulawik] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]">Robert Kulawik</a>
          
          on Friday 22 August 2014 09:04:13 (UTC)
        </p>

        

        
          <p>
            <div>Revision comment:</div>
            <div class="comment">
              <p>* Fix an error in the formula that obtains the overall coverage values in order to exclude the cells with NA values</p><p>* Generate the images in the overview png in the same way as they are generated in the stack png. Also ensure that all of images display the maps well proportioned, independently the version of the R raster package used, this is achive using the funcion getAsp inside the R script.</p><p>* Show the names provided by the user in input parameter nameList, in the case the user provides them, in the column layerName of the csv outputs &quot;rasterSummary&quot; and &quot;overall_statistics&quot;&nbsp;</p>
            </div>
          </p>
        
      </div>
    </li>
  
    <li>
      <div class="title">
        <a href="/workflows/3856/versions/5">BioVeL ESW STACK - ENM Statistical Workflow with raster stack computation</a>
      </div>
      <div class="metadata">

        <p>
          Created
          
            by <a href="/users/62314" title="header=[] body=[Biodiversity eLaboratory] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]">Biodiversity eLaboratory</a>
          
          on Wednesday 22 June 2016 14:45:58 (UTC)
        </p>

        

        
          <p>
            <div>Revision comment:</div>
            <div class="comment">
              <p>Change the location of resources from the biovel google code repository to&nbsp;biovel&nbsp;github repository</p>
            </div>
          </p>
        
      </div>
    </li>
  
</ol>


  </div>
</div>



<!-- END tabs -->

<br/>
<br/>

<div id="ratingsBox">
  <h2>
	<span class="icon"><img alt="Reviews" src="/images/famfamfam_silk/report.png?1680607579" /> </span>	<span style="vertical-align: middle;"><a href="/workflows/3856/reviews">Reviews</a></span>
	<span class="count_text" style="vertical-align: middle;">(0)</span>
</h2>

<div class="reviewsBox">

	
		<p><i>No reviews yet</i></p>
		<a name="reviews"></a>
		<p style="margin-top: 0.6em;">
			<strong><a href="/workflows/3856/reviews/new">Be the first to review!</a></strong>
		</p>
	
	
</div>

</div>

<br/>
<br/>

<div id="commentsBox">
  <script src="/javascripts/ckeditor/ckeditor.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/widgets/tooltip.js?1680607579" type="text/javascript"></script>

<h2>
	<span class="icon"><img alt="Comments" src="/images/famfamfam_silk/comments.png?1680607579" /> </span>	<span style="vertical-align: middle;">Comments</span>
	<span class="count_text" style="vertical-align: middle;">(0)</span>
</h2>

<ul class="sectionIcons">
  <li><span class="icon"><a href="http://www.myexperiment.org/workflows/3856/comments/timeline"><img alt="Timeline" src="/images/famfamfam_silk/timeline_marker.png?1680607579" /> View Timeline</a></span></li>
</ul>

<div class="commentsBox">
	
	
		<p><i>No comments yet</i></p>
		<a name="comments"></a>
		
			<p style="margin-top: 0.6em;"><strong><a href="/session/new">Log in</a> to make a comment </strong></p>
		
	
	
	<br/>
	
	

</div>


</div>

<!-- Other workflows that use a service this workflow users -->

<br />
<br />

<h2>
  <span class="icon"><img alt="Workflow" src="/images/redmond_studio/applications_16.png?1680607579" /> </span>  <span style="vertical-align: middle;">Other workflows that use similar services</span>
  <span class="count_text" style="vertical-align: middle;">(0)</span>
</h2>




    <p>There are no workflows in myExperiment that use similar services to this Workflow.</p>



<!-- OpenURL context object -->

<span class="Z3988" title="url_ver=Z39.88-2004&amp;url_ctx_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Actx&amp;ctx_ver=Z39.88-2004&amp;ctx_tim=2023-08-16T17%3A05%3A00%2B00%3A00&amp;ctx_id=&amp;ctx_enc=info%3Aofi%2Fenc%3AUTF-8&amp;rft.title=BioVeL+ESW+STACK+-+ENM+Statistical+Workflow+with+raster+stack+computation&amp;rft.date=2013-10-13&amp;rft.au=Francisco+Quevedo&amp;rft.genre=unknown&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc"></span>
      </div>
    </div>




            <div id="ft">
          <div class="container">
  <div class="row">
    <div class="col-md-4 text-left">
      Funded by:
      <a href="http://biovel.eu">BioVeL</a>,
      <a href="http://www.epsrc.ac.uk/">EPSRC</a>,
      <a href="http://jisc.ac.uk/">JISC</a>,
      <a href="http://www.microsoft.com">Microsoft</a>

      <br/><br/>

      Affiliates:
      <a href="http://www.mygrid.org.uk">myGrid</a>,
      <a href="http://www.taverna.org.uk/">Taverna</a>,
      <a href="http://www.biocatalogue.org">BioCatalogue</a>
    </div>

    <div class="col-md-4 text-center">
      <a href="/about">About</a> |
      <a href="/privacy">Privacy</a> |
      <a href="http://wiki.myexperiment.org/index.php/Papers">Publications</a> |
      <a href="/feedback">Contact / Feedback</a> |
      <a href="http://lists.nongnu.org/mailman/listinfo/myexperiment-discuss">Mailing List</a>
    </div>

    <div class="col-md-4 text-right">
      Icons: <a href="http://www.famfamfam.com/lab/icons/silk/">Silk icon set 1.3</a><br/><br/>
      
    </div>

  </div>
  <div class="row">
    <div class="col-md-12 text-center">
      Copyright &#169; 2007 &ndash; 2018
      <a href="http://www.manchester.ac.uk/">The University of Manchester</a>
      and
      <a href="http://www.soton.ac.uk/">University of Southampton</a>
    </div>
  </div>
</div>

        </div>
    



<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-1498417-4', 'auto');
    ga('set', 'anonymizeIp', true);
    ga('send', 'pageview');
</script>



  
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-36850736-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  


</body>
</html>

