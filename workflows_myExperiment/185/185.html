<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="google-site-verification" content="3hq0Cfhw5_-EaaNMum0ETX847sTl7jeQ3ZNAla4a6UQ" />
  
  <title>myExperiment &#45; Workflows &#45; Staged iteration strategy (Stian Soiland-Reyes) [Taverna 1 Workflow]</title>
  <link rel="alternate" href="http://www.myexperiment.org/workflows/185.rdf" type="application/rdf+xml" title="RDF+XML" />
  <link rel="alternate" href="http://www.myexperiment.org/workflows/185.xml" type="application/xml" title="REST XML" />
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
  <link href="/stylesheets/acts_as_taggable_stylesheet.css?1680607579" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/star_rating.css?1680607579" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/gadgets.css?1680607579" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/misc_skinning.css?1680607579" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/pagination.css?1680607579" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/bootstrap.css?1680607579" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/navbar.css?1680607579" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/styles.css?1680607579" media="screen" rel="stylesheet" type="text/css" />
  <script src="/javascripts/jquery-1.11.1.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/jquery-noconflict.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/prototype-1.7.2-patched.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/effects.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/dragdrop.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/controls.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/boxover.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/bootstrap.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/tabs.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/folds.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/application.js?1680607579" type="text/javascript"></script>

  
  






  
  
    <script src='//www.google.com/recaptcha/api.js'></script>
  
</head>
<body>



<div class="navbar navbar-myexp" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
          <a id="logo" href="/">
            <img alt="Logo" class="hidden-sm" src="/images/logo.png?1680607579" />
            <img alt="Logo_cropped" class="visible-sm" src="/images/logo_cropped.png?1680607579" />
          </a>
      
    </div>
    <div class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        
          <ul class="nav navbar-nav">
  
    <li >
      <a href="/home">Home</a>    </li>
  
    <li >
      <a href="/users">Users</a>    </li>
  
    <li >
      <a href="/groups">Groups</a>    </li>
  
    <li class="active">
      <a href="/workflows">Workflows</a>    </li>
  
    <li >
      <a href="/files">Files</a>    </li>
  
    <li >
      <a href="/packs">Packs</a>    </li>
  
</ul>

        
        
            <form action="/search" class="navbar-form navbar-left" id="search" method="get">
    <div class="input-group">
      <input class="form-control" id="query" name="query" placeholder="Search" type="text" />
      <span class="input-group-btn">
        
        <input class="btn btn-default" name="commit" type="submit" value="Go" />
        </span>
    </div>
</form>

        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
            <li><a href="/session/new?return_to=%2Fworkflows%2F185.html">Log in</a></li>
    <li><a href="/users/new">Register</a></li>


      </ul>
    </div><!--/.nav-collapse -->
  </div>
  
</div>




    <div class="container" id="main">
      <div id="myexp_breadcrumbs_bar">
        <ol class="breadcrumb">
  <li><a href="/home">Home</a></li>
  


  <li><a href="/workflows">Workflows</a></li>



  
    <li>Staged iteration strategy</li>
  


  <div style="float: right"></div>
</ol>

      </div>
      <div id="myexp_content">
        


        



<h1 class="contribution_title">
  Staged iteration strategy
</h1>

<div class="contribution_aftertitle">
	<b>Created:</b> 2008-05-07 12:10:27
	
		&nbsp;&nbsp;&nbsp;&nbsp;
		<b>Last updated: </b>2008-05-07 12:32:36
	
</div>
<ul class="sectionIcons">
  
      <li><span class="icon"><a href="http://www.myexperiment.org/workflows/185/download/Staged_iteration_strategy-v1.xml?version=1"><img alt="Download Workflow (for version 1)" src="/images/redmond_studio/arrow-down_16.png?1680607579" /> Download Workflow</a></span></li>
      
  
      
</ul>


<div class="contribution_left_box">

  <div class="contribution_version_box">



    <div class="contribution_version_inner_box">

      
    <div class="contribution_description">
      <p>Consider two lists <em>A</em> and <em>B</em>, of equal size 3.
<code>A[1]</code> corresponds to <code>B[1]</code>, <code>A[2]</code> to
<code>B[2]</code>, etc, for instance <em>A</em> are image scans from
2007 and <em>B</em> from 2008, and the index indicates the patient
number.</p>

<pre>
A = [a0, a1, a2]
B = [b0, b1, b2]
</pre>

<p>
There's then two lists of possible parameters <em>P</em> and <em>Q</em>,
of different lengths, <em>P</em> has 2 and <em>Q</em> has 4 items.</p>
<pre>
P = [p0, p1]
Q = [q0, q1, q2, q3]
</pre>

<p>
Each of the <em>A</em> items should be processed in <em>ap</em> using
each of the <em>P</em> parameters, and each of the <em>B</em> items
processed in <em>bq</em> using each of the <em>Q</em> parameters.  </p>

<p>
The problem then is how to compare <em>AnPp</em> against the all
<em>BnQq</em> - but notice that <em>An</em> and <em>Bn</em> have to
match. The normal crossproduct would compare all <em>AaPp</em> against
all <em>BbQq</em> - but we want to restrict the iteration strategy. We
can't use the <strong>dot product</strong> directly because for a given
patient n we want to compare all <em>P</em>s against all <em>Q</em>s
using the <strong>cross product</strong>.  </p>

<p>
This is solved in t2 using <strong>staged iteration</strong>, but here
is a hack showing how this can be achieved in t1 using a <strong>nested
workflow</strong>. The nested workflow basically &quot;stops&quot; the
iteration at list level, due to the <em>echo_lists</em> inside that
makes the nested workflow excpect lists.
</p>

<p>
There's explicit <code>crossproduct(p,a)</code> strategy set on
<em>ap</em> and <code>crossproduct(q,b)</code> on <em>bq</em> to make
sure they output with the <em>a</em>/<em>b</em> iteration at the highest
level lists, ie. <em>ap</em> outputs:</p>

<pre>
[  [ a0p0, a0p1], 
   [ a1p0, a1p1],
   [ a2p0, a2p1]
]
</pre>

<p>So the top level lists from <em>ap</em> corresponds to each item of
<em>A</em>. The same trick applies to <em>bq</em> - if we don't specify
this the implicit iteration might output the opposite with the highest
list corresponding to the <em>P</em>s and <em>Q</em>s. <em>(Hint: Simply
drag </em>p<em> or </em>a<em> within the iteration strategy editor to
change the order)</em> </p>

<p>
The second part is to use a nested workflow that takes the outputs from
<em>ap</em> and <em>bq</em>, but through the <em>Echo list</em> local
worker. This worker doesn't do anything except it forces the nested
workflow to take a list of items as inputs instead of single inputs.
</p>
<p>
Hence we can set a <code>dotproduct(pq, ap)</code> on the processor for
the nested workflow <em>apbq_iter</em> - since <strong>this nested
workflow consumes lists</strong> at both ports this means it will be
iterated over with these inputs:</p>

<pre>
ap = [ a0p0, a0p1]    bq = [b0q0, b0q1, b0q2, b0q3]
ap = [ a1p0, a1p1]    bq = [b1q0, b1q1, b1q2, b1q3]
ap = [ a2p0, a2p1]    bq = [b2q0, b2q1, b2q2, b2q3]
</pre>

<p> Inside the nested workflow there's the normal <code>crossproduct(pq,
ap)</code> so that it can do an all-to-all comparison.</p>

<p><em>(The beanshell inside </em>apbq<em> here actually only returns
the string <code>ap+bq</code>, </em>ap<em> returns <code>a+p</code> and
</em>bq<em> returns <code>p+q</code>, but assume that instead there was
real services invoked for each of these processors doing some kind of
filtering/comparison operation using the given parameters, and that
<code>a0p0</code> etc. are the outputs of those operations.)</em>
</p>

<p>
With this hack we can run a <strong>dotproduct</strong> for the
<strong>outer</strong> list, and a <strong>crossproduct</strong> for the
<strong>inner</strong> list.
</p>

<p>
The output of running this workflow should be:
</p>

<pre>
{
  [ (a0p0b0q0, a0p0b0q1, a0p0b0q2, a0p0b0q3),
    (a0p1b0q0, a0p1b0q1, a0p1b0q2, a0p1b0q3)
  ],
  [ (a1p0b1q0, a1p0b1q1, a1p0b1q2, a1p0b1q3),
    (a1p1b1q0, a1p1b1q1, a1p1b1q2, a1p1b1q3)
  ],
  [ (a2p0b2q0, a2p0b2q1, a2p0b2q2, a2p0b2q3),
    (a2p1b2q0, a2p1b2q1, a2p1b2q2, a2p1b2q3)
  ]
}

</pre>


<p>
So in the final output <code>{}</code> (depth=3) there's three big
<code>[]</code> lists of depth 2, corresponding to
<code>a0/</code><code>b0</code>, <code>a1</code>/<code>b1</code> and
<code>b2</code>/<code>b2</code>. Within each of these are two
<code> ()</code> lists of depth 1 corresponding to <code>p0</code> and
<code>p1</code>. The content of these lists (depth 0) are the
actual items returned from <em>apbq</em> - one for each
of <code>q0,q1,q2,q3</code>.
</p>
    </div>


      <h3>
        <img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[This section shows the preview of this version of the Workflow (click on the image to expand)] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
        Preview
      </h3>

      

          <div class="contribution_preview" style="width: 100%;">
            <p style="text-align: center">
              <a href="/workflows/185/versions/1/previews/full" onclick="window.open(this.href);return false;"><img alt="Medium" src="/workflows/185/versions/1/previews/medium" /></a>
            </p>
            
                <p style="text-align: right; color: #666666;">
                  <a href="/workflows/185/versions/1/previews/svg">Download as scalable diagram (SVG)</a>
                </p>
            

            
          </div>
      



      <h3>
        <img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[This section provides options for running this version of the Workflow] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
        Run
      </h3>

      
          
              <div style="margin: 0 0.5em;">
	<h4>
		Run this Workflow in the Taverna Workbench...
	</h4>
	
	<div class="option_box">
		
		<p style="text-align: center;">
			<b>Option 1:</b>
		</p>
		
		<p style="font-size: 93%; text-align: center;">
			Copy and paste this link into File > 'Open workflow location...'<br/>
			<a href="http://www.myexperiment.org/workflows/185/download?version=1">http://www.myexperiment.org/workflows/185/download?version=1</a><br/>
			<small>[ <a href="#" onclick="Effect.toggle(&quot;run_taverna_more_box&quot;,'blind',{duration:0.3});; return false;">More Info<img alt="Expand" src="/images/folds/unfold.png?1680607579" style="margin-left: 0.3em; vertical-align: middle;" /></a> ]</small>
		</p>
		
		<div id="run_taverna_more_box" style="display: none;">
			<p style="font-size: 85%; margin-top: 0.5em; text-align: center;">
				Taverna is available from <a href="http://taverna.sourceforge.net/" onclick="window.open(this.href);return false;">http://taverna.sourceforge.net/</a>
			</p>
			
			<p style="text-align: center; margin-top: 0.5em; font-size: 85%;">
				If you are having problems downloading it in Taverna, you may need to provide your username and password in the URL so that Taverna can access the Workflow: <br/>
				
					<b>Replace <font color="#990000">http://</font> in the link above with <font color="#990000">http://yourusername:yourpassword@</font></b>
				
			</p>
		</div>
	
	</div>
	
	
</div>
          
      

      <br/>

      <h3>
        <img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[This section shows the internal components of this workflow version] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
        Workflow Components
      </h3>

      
          
              

	
		
		<!-- Sources -->
		
		<div class="fold">
			<div class="foldTitle">
		    Inputs (0)
			</div>
		  <div class="foldContent" style="display: none;">
				
					<p class="none_text">None</p>
				
			</div>
		</div>
		
		<!-- Processors -->
		
		<div class="fold">
			<div class="foldTitle">
		    Processors (9)
			</div>
		  <div class="foldContent" style="display: none;">
				
					<table class="simple">
					  <tr>
					    <th>Name</th>
							<th>Type</th>
					    <th>Description</th>
					  </tr>
					
						
						  <tr>
						    <td><b>P</b></td>
								<td>beanshell</td>
						    <td></td>
						  </tr>
						
						  <tr>
						    <td><b>A</b></td>
								<td>beanshell</td>
						    <td></td>
						  </tr>
						
						  <tr>
						    <td><b>Q</b></td>
								<td>beanshell</td>
						    <td></td>
						  </tr>
						
						  <tr>
						    <td><b>B</b></td>
								<td>beanshell</td>
						    <td></td>
						  </tr>
						
						  <tr>
						    <td><b>bq</b></td>
								<td>beanshell</td>
						    <td></td>
						  </tr>
						
						  <tr>
						    <td><b>ap</b></td>
								<td>beanshell</td>
						    <td></td>
						  </tr>
						
						  <tr>
						    <td><b>apbq_iter</b></td>
								<td>workflow</td>
						    <td></td>
						  </tr>
						
						  <tr>
						    <td><b>Flatten_list</b></td>
								<td>local</td>
						    <td></td>
						  </tr>
						
						  <tr>
						    <td><b>Merge_string_list_to_string</b></td>
								<td>local</td>
						    <td></td>
						  </tr>
						
					</table>
				
			</div>
		</div>
		
		<!-- Beanshells -->
    
    <div class="fold">
      <div class="foldTitle">
        Beanshells (7)
      </div>
      <div class="foldContent" style="display: none;">
        
          <table class="simple">
            <tr>
              <th>Name</th>
              <th>Description</th>
              <th>Inputs</th>
              <th>Outputs</th>
            </tr>
          
            
              <tr>
                <td><b>apbq</b></td>
                <td></td>
                <td>
                  
                    
                      ap
                      <hr />
                    
                      bq
                      
                    
                  
                </td>
                <td>
                  
                    
                      apbq
                      
                    
                  
                </td>
              </tr>
            
              <tr>
                <td><b>P</b></td>
                <td></td>
                <td>
                  
                </td>
                <td>
                  
                    
                      P
                      
                    
                  
                </td>
              </tr>
            
              <tr>
                <td><b>A</b></td>
                <td></td>
                <td>
                  
                </td>
                <td>
                  
                    
                      A
                      
                    
                  
                </td>
              </tr>
            
              <tr>
                <td><b>Q</b></td>
                <td></td>
                <td>
                  
                </td>
                <td>
                  
                    
                      Q
                      
                    
                  
                </td>
              </tr>
            
              <tr>
                <td><b>B</b></td>
                <td></td>
                <td>
                  
                </td>
                <td>
                  
                    
                      B
                      
                    
                  
                </td>
              </tr>
            
              <tr>
                <td><b>bq</b></td>
                <td></td>
                <td>
                  
                    
                      b
                      <hr />
                    
                      q
                      
                    
                  
                </td>
                <td>
                  
                    
                      bq
                      
                    
                  
                </td>
              </tr>
            
              <tr>
                <td><b>ap</b></td>
                <td></td>
                <td>
                  
                    
                      a
                      <hr />
                    
                      p
                      
                    
                  
                </td>
                <td>
                  
                    
                      ap
                      
                    
                  
                </td>
              </tr>
            
          </table>
        
      </div>
    </div>
    
    <!-- Sinks -->
		
		<div class="fold">
			<div class="foldTitle">
		    Outputs (2)
			</div>
		  <div class="foldContent" style="display: none;">
				
					<table class="simple">
					  <tr>
					    <th>Name</th>
					    <th>Description</th>
					  </tr>
					
						
						  <tr>
						    <td><b>apbq</b></td>
						    <td></td>
						  </tr>
						
						  <tr>
						    <td><b>flattened</b></td>
						    <td></td>
						  </tr>
						
					</table>
				
			</div>
		</div>
		
		<!-- Links -->
		
		<div class="fold">
			<div class="foldTitle">
		    Links (10)
			</div>
		  <div class="foldContent" style="display: none;">
				
					<table class="simple">
					  <tr>
					    <th>Source</th>
					    <th>Sink</th>
					  </tr>
					
						
						  <tr>
						    <td>A:A</td>
						    <td>ap:a</td>
						  </tr>
						
						  <tr>
						    <td>B:B</td>
						    <td>bq:b</td>
						  </tr>
						
						  <tr>
						    <td>Flatten_list:outputlist</td>
						    <td>Merge_string_list_to_string:stringlist</td>
						  </tr>
						
						  <tr>
						    <td>Merge_string_list_to_string:concatenated</td>
						    <td>flattened</td>
						  </tr>
						
						  <tr>
						    <td>P:P</td>
						    <td>ap:p</td>
						  </tr>
						
						  <tr>
						    <td>Q:Q</td>
						    <td>bq:q</td>
						  </tr>
						
						  <tr>
						    <td>ap:ap</td>
						    <td>apbq_iter:ap</td>
						  </tr>
						
						  <tr>
						    <td>apbq_iter:apbq</td>
						    <td>Flatten_list:inputlist</td>
						  </tr>
						
						  <tr>
						    <td>apbq_iter:apbq</td>
						    <td>apbq</td>
						  </tr>
						
						  <tr>
						    <td>bq:bq</td>
						    <td>apbq_iter:pq</td>
						  </tr>
						
					</table>
				
			</div>
		</div>
		
		<!-- Coordinations -->
		
		<div class="fold">
			<div class="foldTitle">
		    Coordinations (0)
			</div>
		  <div class="foldContent" style="display: none;">
				
					<p class="none_text">None</p>
				
			</div>
		</div>
	
	


          
      
    </div>

  </div>

</div>

<div class="contribution_right_box">
  <div class="contribution_section_box" style= "font-size: 100%; padding: 0.7em 0.9em; font-weight: bold;">
    <p><img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[The type of workflow system that this Workflow is designed for.] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" /> Workflow Type</p>
    <p><a href="/content_types/1">Taverna 1</a></p>
  </div>

  <div class="contribution_section_box">
	<p class="heading">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[The Uploader is the person who uploaded/created this Workflow on myExperiment, and who manages it on myExperiment.] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		Uploader
	</p>
	<p>
		<center>
			<div class="avatar" style="width: 66px">
  <a href="/users/5"><img alt="9?size=60x60" class="framed" src="/pictures/show/9?size=60x60" title="Stian Soiland-Reyes" /></a>
  
	<span style="display:block;margin-top:2px;text-align:center;">
		
			<img alt="Gb" src="/images/famfamfam_flags/gb.png?1680607579" style="vertical-align:middle; margin-right: 0.3em;" title="header=[] body=[&lt;b&gt;Location: &lt;/b&gt;Manchester, United Kingdom] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		

    
			<a href="/users/5" title="header=[] body=[Stian Soiland-Reyes] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]">Stian Soiland-Reyes</a>
		

    
	</span>
  
</div>

		</center>
	</p>
</div>


  

  

<div class="contribution_section_box">
	<p class="heading">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[This specifies what rights users have when they download and use this Workflow.] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		License
		<a name="license"></a>
	</p>

  

    
    
    
    
    


    

    <!--

    <rdf:RDF xmlns="http://creativecommons.org/ns#"
        xmlns:dc="http://purl.org/dc/elements/1.1/"
        xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
    <Work rdf:about="">
       <dc:title>Staged iteration strategy</dc:title>
       <dc:date>2008-05-07 12:10:27 UTC</dc:date>
       <dc:description>&lt;p&gt;Consider two lists &lt;em&gt;A&lt;/em&gt; and &lt;em&gt;B&lt;/em&gt;, of equal size 3.
&lt;code&gt;A[1]&lt;/code&gt; corresponds to &lt;code&gt;B[1]&lt;/code&gt;, &lt;code&gt;A[2]&lt;/code&gt; to
&lt;code&gt;B[2]&lt;/code&gt;, etc, for instance &lt;em&gt;A&lt;/em&gt; are image scans from
2007 and &lt;em&gt;B&lt;/em&gt; from 2008, and the index indicates the patient
number.&lt;/p&gt;

&lt;pre&gt;
A = [a0, a1, a2]
B = [b0, b1, b2]
&lt;/pre&gt;

&lt;p&gt;
There&#39;s then two lists of possible parameters &lt;em&gt;P&lt;/em&gt; and &lt;em&gt;Q&lt;/em&gt;,
of different lengths, &lt;em&gt;P&lt;/em&gt; has 2 and &lt;em&gt;Q&lt;/em&gt; has 4 items.&lt;/p&gt;
&lt;pre&gt;
P = [p0, p1]
Q = [q0, q1, q2, q3]
&lt;/pre&gt;

&lt;p&gt;
Each of the &lt;em&gt;A&lt;/em&gt; items should be processed in &lt;em&gt;ap&lt;/em&gt; using
each of the &lt;em&gt;P&lt;/em&gt; parameters, and each of the &lt;em&gt;B&lt;/em&gt; items
processed in &lt;em&gt;bq&lt;/em&gt; using each of the &lt;em&gt;Q&lt;/em&gt; parameters.  &lt;/p&gt;

&lt;p&gt;
The problem then is how to compare &lt;em&gt;AnPp&lt;/em&gt; against the all
&lt;em&gt;BnQq&lt;/em&gt; - but notice that &lt;em&gt;An&lt;/em&gt; and &lt;em&gt;Bn&lt;/em&gt; have to
match. The normal crossproduct would compare all &lt;em&gt;AaPp&lt;/em&gt; against
all &lt;em&gt;BbQq&lt;/em&gt; - but we want to restrict the iteration strategy. We
can&#39;t use the &lt;strong&gt;dot product&lt;/strong&gt; directly because for a given
patient n we want to compare all &lt;em&gt;P&lt;/em&gt;s against all &lt;em&gt;Q&lt;/em&gt;s
using the &lt;strong&gt;cross product&lt;/strong&gt;.  &lt;/p&gt;

&lt;p&gt;
This is solved in t2 using &lt;strong&gt;staged iteration&lt;/strong&gt;, but here
is a hack showing how this can be achieved in t1 using a &lt;strong&gt;nested
workflow&lt;/strong&gt;. The nested workflow basically &amp;quot;stops&amp;quot; the
iteration at list level, due to the &lt;em&gt;echo_lists&lt;/em&gt; inside that
makes the nested workflow excpect lists.
&lt;/p&gt;

&lt;p&gt;
There&#39;s explicit &lt;code&gt;crossproduct(p,a)&lt;/code&gt; strategy set on
&lt;em&gt;ap&lt;/em&gt; and &lt;code&gt;crossproduct(q,b)&lt;/code&gt; on &lt;em&gt;bq&lt;/em&gt; to make
sure they output with the &lt;em&gt;a&lt;/em&gt;/&lt;em&gt;b&lt;/em&gt; iteration at the highest
level lists, ie. &lt;em&gt;ap&lt;/em&gt; outputs:&lt;/p&gt;

&lt;pre&gt;
[  [ a0p0, a0p1], 
   [ a1p0, a1p1],
   [ a2p0, a2p1]
]
&lt;/pre&gt;

&lt;p&gt;So the top level lists from &lt;em&gt;ap&lt;/em&gt; corresponds to each item of
&lt;em&gt;A&lt;/em&gt;. The same trick applies to &lt;em&gt;bq&lt;/em&gt; - if we don&#39;t specify
this the implicit iteration might output the opposite with the highest
list corresponding to the &lt;em&gt;P&lt;/em&gt;s and &lt;em&gt;Q&lt;/em&gt;s. &lt;em&gt;(Hint: Simply
drag &lt;/em&gt;p&lt;em&gt; or &lt;/em&gt;a&lt;em&gt; within the iteration strategy editor to
change the order)&lt;/em&gt; &lt;/p&gt;

&lt;p&gt;
The second part is to use a nested workflow that takes the outputs from
&lt;em&gt;ap&lt;/em&gt; and &lt;em&gt;bq&lt;/em&gt;, but through the &lt;em&gt;Echo list&lt;/em&gt; local
worker. This worker doesn&#39;t do anything except it forces the nested
workflow to take a list of items as inputs instead of single inputs.
&lt;/p&gt;
&lt;p&gt;
Hence we can set a &lt;code&gt;dotproduct(pq, ap)&lt;/code&gt; on the processor for
the nested workflow &lt;em&gt;apbq_iter&lt;/em&gt; - since &lt;strong&gt;this nested
workflow consumes lists&lt;/strong&gt; at both ports this means it will be
iterated over with these inputs:&lt;/p&gt;

&lt;pre&gt;
ap = [ a0p0, a0p1]    bq = [b0q0, b0q1, b0q2, b0q3]
ap = [ a1p0, a1p1]    bq = [b1q0, b1q1, b1q2, b1q3]
ap = [ a2p0, a2p1]    bq = [b2q0, b2q1, b2q2, b2q3]
&lt;/pre&gt;

&lt;p&gt; Inside the nested workflow there&#39;s the normal &lt;code&gt;crossproduct(pq,
ap)&lt;/code&gt; so that it can do an all-to-all comparison.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;(The beanshell inside &lt;/em&gt;apbq&lt;em&gt; here actually only returns
the string &lt;code&gt;ap+bq&lt;/code&gt;, &lt;/em&gt;ap&lt;em&gt; returns &lt;code&gt;a+p&lt;/code&gt; and
&lt;/em&gt;bq&lt;em&gt; returns &lt;code&gt;p+q&lt;/code&gt;, but assume that instead there was
real services invoked for each of these processors doing some kind of
filtering/comparison operation using the given parameters, and that
&lt;code&gt;a0p0&lt;/code&gt; etc. are the outputs of those operations.)&lt;/em&gt;
&lt;/p&gt;

&lt;p&gt;
With this hack we can run a &lt;strong&gt;dotproduct&lt;/strong&gt; for the
&lt;strong&gt;outer&lt;/strong&gt; list, and a &lt;strong&gt;crossproduct&lt;/strong&gt; for the
&lt;strong&gt;inner&lt;/strong&gt; list.
&lt;/p&gt;

&lt;p&gt;
The output of running this workflow should be:
&lt;/p&gt;

&lt;pre&gt;
{
  [ (a0p0b0q0, a0p0b0q1, a0p0b0q2, a0p0b0q3),
    (a0p1b0q0, a0p1b0q1, a0p1b0q2, a0p1b0q3)
  ],
  [ (a1p0b1q0, a1p0b1q1, a1p0b1q2, a1p0b1q3),
    (a1p1b1q0, a1p1b1q1, a1p1b1q2, a1p1b1q3)
  ],
  [ (a2p0b2q0, a2p0b2q1, a2p0b2q2, a2p0b2q3),
    (a2p1b2q0, a2p1b2q1, a2p1b2q2, a2p1b2q3)
  ]
}

&lt;/pre&gt;


&lt;p&gt;
So in the final output &lt;code&gt;{}&lt;/code&gt; (depth=3) there&#39;s three big
&lt;code&gt;[]&lt;/code&gt; lists of depth 2, corresponding to
&lt;code&gt;a0/&lt;/code&gt;&lt;code&gt;b0&lt;/code&gt;, &lt;code&gt;a1&lt;/code&gt;/&lt;code&gt;b1&lt;/code&gt; and
&lt;code&gt;b2&lt;/code&gt;/&lt;code&gt;b2&lt;/code&gt;. Within each of these are two
&lt;code&gt; ()&lt;/code&gt; lists of depth 1 corresponding to &lt;code&gt;p0&lt;/code&gt; and
&lt;code&gt;p1&lt;/code&gt;. The content of these lists (depth 0) are the
actual items returned from &lt;em&gt;apbq&lt;/em&gt; - one for each
of &lt;code&gt;q0,q1,q2,q3&lt;/code&gt;.
&lt;/p&gt;</dc:description>
       <dc:creator><Agent>
          <dc:title><a href="/users/5" title="header=[] body=[Stian Soiland-Reyes] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]">Stian Soiland-Reyes</a></dc:title>
       </Agent></dc:creator>
       <dc:rights><Agent>
          <dc:title><a href="/users/5" title="header=[] body=[Stian Soiland-Reyes] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]">Stian Soiland-Reyes</a></dc:title>
       </Agent></dc:rights>
       <dc:type rdf:resource="http://purl.org/dc/dcmitype/Data" />
       <dc:source rdf:resource="http://www.myexperiment.org/workflows/185.html"/>
       <license rdf:resource="http://creativecommons.org/licenses/by-sa/3.0/" />
    </Work>

    <License rdf:about="http://creativecommons.org/licenses/by-sa/3.0/">
      <permits rdf:resource="http://creativecommons.org/ns#Reproduction" />  <permits rdf:resource="http://creativecommons.org/ns#Distribution" />  <requires rdf:resource="http://creativecommons.org/ns#Notice" />  <requires rdf:resource="http://creativecommons.org/ns#Attribution" />  <permits rdf:resource="http://creativecommons.org/ns#DerivativeWorks" />  <requires rdf:resource="http://creativecommons.org/ns#ShareAlike" />
    </License>

    </rdf:RDF>

    -->

  

  <div class="contribution_currentlicense">
    <p>
      
        All versions of this Workflow are
      
      
        licensed under: <br/><br/><a rel="Copyright" href="/licenses/2" title="Creative Commons Attribution-Share Alike 3.0 Unported License"><img src="/images/by-sa.png" /></a>
      
    </p>
  </div>
	
</div>


  <script type="text/javascript">
    function showVersion(form) {
        var url = $("resource_versions").value;
        location.href = url;
        form.submit
    }
</script>
<style>
  .version_selection {
      font-size:smaller;
      text-align: center;
  }
</style>

<div class="contribution_section_box">
  <p class="heading">
    <img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[This box shows version 1 for this entry] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />    <span>Version 1 </span>
    <span class="count_text">(of 1)</span>
  </p>
  
</div>

  <div class="contribution_section_box">
	
	<p class="heading" style="margin-bottom: 0; padding-bottom: 0;">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[Which people/groups get the credit for this Workflow?] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		Credits <span class="count_text">(1)</span>
		<a name="credits"></a>
	</p>
	<span style="font-size: 85%; color: #666666; display: block; padding: 0.3em 0.5em 0 0.5em; margin: 0; line-height: 1em;">(People/Groups)</span>
	
		<div style="font-size: 85%;">
			<ul class="items">
				
					<li>
						
							
								<span class="icon"><img alt="User" src="/images/famfamfam_silk/user.png?1680607579" /> </span> 
							
							<a href="/users/5" title="header=[] body=[Stian Soiland-Reyes] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]">Stian Soiland-Reyes</a>
						
					</li>
				
			</ul>
		</div>
	
	
	
	<p class="heading" style="margin-bottom: 0; padding-bottom: 0;">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[What other Workflows/Files is this one based on?] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		Attributions <span class="count_text">(0)</span>
		<a name="attributions"></a>
	</p>
	<span style="font-size: 85%; color: #666666; display: block; padding: 0.3em 0.5em 0 0.5em; margin: 0; line-height: 1em;">(Workflows/Files)</span>
	
		<p class="none_text">None</p>
	
	
	
	
</div>


  


  <div class="contribution_section_box">
	<p class="heading">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[The tags for this Workflow entry.&lt;br/&gt;Note(1): if this Workflow has many versions, the tags apply to ALL versions in this entry.&lt;br/&gt;Note(2): the size of the tags show how popular they are on myExperiment.] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		Tags <span id="tags_box_header_tag_count_span" class="count_text">(7)</span>
		<a name="tags"></a>
	</p>

	<script type="text/javascript">
  function showAllTags() {
    Element.show('all_tags');
	  Element.hide('user_tags');
	  return false;
  }
  
  function showUsersTags() {
  	Element.hide('all_tags');
	  Element.show('user_tags');
	  return false;
  }
	
	function flip_tags_mode()
	{
		if( $('toggle_tags_mode').checked )
		  showUsersTags();
	  else
		  showAllTags();
	}
</script>

<div id="tags_inner_box">
	
		<div class="box_currentuser_specific" style="padding: 0.3em 0.2em; margin: 0.6em 0.4em;">
		  <label for="toggle_tags_mode" style="font-size: 85%; font-weight: bold;"><input id="toggle_tags_mode" name="toggle_tags_mode" onclick="flip_tags_mode();" style="margin-right: 0.3em;" type="checkbox" value="1" />Uploader tags</label>
		</div>
		<div id="all_tags">
			
				<div class="hTagcloud">
  <ul class="popularity">
    <li><a href='/tags/773' class='popular'>crossproduct</a></li>
<li> | </li>
    <li><a href='/tags/772' class='popular'>dotproduct</a></li>
<li> | </li>
    <li><a href='/tags/555' class='vvvv-popular'>example</a></li>
<li> | </li>
    <li><a href='/tags/652' class='popular'>iteration</a></li>
<li> | </li>
    <li><a href='/tags/774' class='popular'>staged</a></li>
<li> | </li>
    <li><a href='/tags/771' class='popular'>strategy</a></li>
<li> | </li>
    <li><a href='/tags/663' class='v-popular'>taverna</a></li>
  </ul>
</div>

			
		</div>
		<div id="user_tags"  style="display: none;">
			
				<div class="hTagcloud">
  <ul class="popularity">
    <li><a href='/tags/773' class='popular'>crossproduct</a></li>
<li> | </li>
    <li><a href='/tags/772' class='popular'>dotproduct</a></li>
<li> | </li>
    <li><a href='/tags/555' class='vvvv-popular'>example</a></li>
<li> | </li>
    <li><a href='/tags/652' class='popular'>iteration</a></li>
<li> | </li>
    <li><a href='/tags/774' class='popular'>staged</a></li>
<li> | </li>
    <li><a href='/tags/771' class='popular'>strategy</a></li>
<li> | </li>
    <li><a href='/tags/663' class='v-popular'>taverna</a></li>
  </ul>
</div>

			
		</div>
	
</div>
	
	
	
	
		<p><small><b><a href="/session/new">Log in</a></b> to add Tags</small></p>
	
</div>


  
<div class="contribution_section_box">
	<p class="heading">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[All the Groups that this item has been shared with] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		Shared with Groups <span class="count_text">(0)</span>
	</p>
	
		<p class="none_text">None</p>
	
</div>

  <div class="contribution_section_box" id="in_packs_box">
  
	<p class="heading">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[All the Packs that this item (or versions of this item [[if available]]) is referred to in] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		Featured In Packs  <span class="count_text">(0)</span>
		<a name="featured_in_packs"></a>
	</p>
	
		<p class="none_text">None</p>
	
	
	
		<p><small><b><a href="/session/new">Log in</a></b> to add to one of your Packs</small></p>
	
</div>


  <div class="contribution_section_box">
	
	<p class="heading" style="margin-bottom: 0; padding-bottom: 0;">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[Shows files and workflows that have attributed this Workflow.] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		Attributed By <span class="count_text">(0)</span>
	  <a name="attributed_by"></a>
	</p>
	<span style="font-size: 85%; color: #666666; display: block; padding: 0.3em 0.5em 0 0.5em; margin: 0; line-height: 1em;">(Workflows/Files)</span>
	
		
		<p class="none_text">None</p>
	
	
</div>


  
<div class="contribution_section_box">
	<p class="heading">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[The users who have added this Workflow to their favourites] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		Favourited By <font class="count_text">(0)</font>
		<a name="favourited_by"></a>
	</p>
	
	
		<p class="none_text">No one</p>
	
	
	
</div>

  

<div class="contribution_section_box">
	<p class="heading" style="margin-bottom: 0.3em;">
		<img alt="Information" src="/images/famfamfam_silk/information.png?1680607579" style="vertical-align:middle;" title="header=[] body=[Viewing / download counts are grand totals for this Workflow.&lt;br/&gt;Click &#39;see breakdown&#39; to view details.] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]" />
		Statistics
	</p>
	
	<div class="stats_box"> 
		<p style="font-size: 85%;">
  2647 viewings
</p>

	<p style="font-size: 85%;">
	  2615 downloads
	</p>

<p style="margin-top: 0.2em;">
	<small>[ <a href="/workflows/185/statistics">see breakdown</a> ]</small>
</p>
		
		<div class="fold" style="padding-top: 0.6em;">
			<div class="foldTitle">More</div>
			<div class="foldContent" style="display: none; text-align: left;">
				
					<p>
						<a href="#credits">1 credit</a> <!-- won't work for type=='group'; needs anchor called '#group_creditations' -->
					</p>
					
					<p>
						<a href="#attributions">0 attributions</a>
					</p>
				
				
				
					<p>
			      <a href="#tags">7 tags</a>
			    </p>
				
				
				
					<p>
			      <a href="#favourited_by">0 favourites</a>
			    </p>
				

				
					<p>
						<a href="#citations">0 citations</a>
			    </p>
				
				
				
					<p>
			      <a href="#reviews">0 reviews</a>
			    </p>
				
				
				
			    <p>
			    	<a href="#comments">0 comments</a>
			    </p>
				
			</div>
		</div>
		
		
		
		
	</div>
</div>

</div>

<div class="clearer">&nbsp;</div>

<!-- BEGIN tabs -->

<br/>

<div id="tabsContainer" class="tabsContainer"></div>

<div class="tabContainer">
  <div class="tabTitle">Citations (0)</div>
  <div class="tabContent">

    <a name="citations"></a>
    
      <p><i>None</i></p>
    
		
		<br/>

    

  </div>
</div>


<div class="tabContainer">
  <div class="tabTitle">Version History</div>
  <div class="tabContent">
    <a name="version_history"></a>
    <p>In chronological order:</p>

<ol class="version_history">
  
    <li>
      <div class="title">
        <a href="/workflows/185/versions/1">Staged iteration strategy</a>
      </div>
      <div class="metadata">

        <p>
          Created
          
            by <a href="/users/5" title="header=[] body=[Stian Soiland-Reyes] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]">Stian Soiland-Reyes</a>
          
          on Wednesday 07 May 2008 12:10:27 (UTC)
        </p>

        
          <p>
            Last edited
            
              by <a href="/users/5" title="header=[] body=[Stian Soiland-Reyes] cssheader=[boxoverTooltipHeader] cssbody=[boxoverTooltipBody] delay=[200]">Stian Soiland-Reyes</a>
            
            on Wednesday 07 May 2008 12:32:36 (UTC)
          </p>
        

        
      </div>
    </li>
  
</ol>


  </div>
</div>



<!-- END tabs -->

<br/>
<br/>

<div id="ratingsBox">
  <h2>
	<span class="icon"><img alt="Reviews" src="/images/famfamfam_silk/report.png?1680607579" /> </span>	<span style="vertical-align: middle;"><a href="/workflows/185/reviews">Reviews</a></span>
	<span class="count_text" style="vertical-align: middle;">(0)</span>
</h2>

<div class="reviewsBox">

	
		<p><i>No reviews yet</i></p>
		<a name="reviews"></a>
		<p style="margin-top: 0.6em;">
			<strong><a href="/workflows/185/reviews/new">Be the first to review!</a></strong>
		</p>
	
	
</div>

</div>

<br/>
<br/>

<div id="commentsBox">
  <script src="/javascripts/ckeditor/ckeditor.js?1680607579" type="text/javascript"></script>
<script src="/javascripts/widgets/tooltip.js?1680607579" type="text/javascript"></script>

<h2>
	<span class="icon"><img alt="Comments" src="/images/famfamfam_silk/comments.png?1680607579" /> </span>	<span style="vertical-align: middle;">Comments</span>
	<span class="count_text" style="vertical-align: middle;">(0)</span>
</h2>

<ul class="sectionIcons">
  <li><span class="icon"><a href="http://www.myexperiment.org/workflows/185/comments/timeline"><img alt="Timeline" src="/images/famfamfam_silk/timeline_marker.png?1680607579" /> View Timeline</a></span></li>
</ul>

<div class="commentsBox">
	
	
		<p><i>No comments yet</i></p>
		<a name="comments"></a>
		
			<p style="margin-top: 0.6em;"><strong><a href="/session/new">Log in</a> to make a comment </strong></p>
		
	
	
	<br/>
	
	

</div>


</div>

<!-- Other workflows that use a service this workflow users -->

<br />
<br />

<h2>
  <span class="icon"><img alt="Workflow" src="/images/redmond_studio/applications_16.png?1680607579" /> </span>  <span style="vertical-align: middle;">Other workflows that use similar services</span>
  <span class="count_text" style="vertical-align: middle;">(0)</span>
</h2>




    <p>There are no workflows in myExperiment that use similar services to this Workflow.</p>



<!-- OpenURL context object -->

<span class="Z3988" title="url_ver=Z39.88-2004&amp;url_ctx_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Actx&amp;ctx_ver=Z39.88-2004&amp;ctx_tim=2023-08-15T22%3A47%3A54%2B00%3A00&amp;ctx_id=&amp;ctx_enc=info%3Aofi%2Fenc%3AUTF-8&amp;rft.title=Staged+iteration+strategy&amp;rft.date=2008-05-07&amp;rft.au=Stian+Soiland-Reyes&amp;rft.genre=unknown&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc"></span>
      </div>
    </div>




            <div id="ft">
          <div class="container">
  <div class="row">
    <div class="col-md-4 text-left">
      Funded by:
      <a href="http://biovel.eu">BioVeL</a>,
      <a href="http://www.epsrc.ac.uk/">EPSRC</a>,
      <a href="http://jisc.ac.uk/">JISC</a>,
      <a href="http://www.microsoft.com">Microsoft</a>

      <br/><br/>

      Affiliates:
      <a href="http://www.mygrid.org.uk">myGrid</a>,
      <a href="http://www.taverna.org.uk/">Taverna</a>,
      <a href="http://www.biocatalogue.org">BioCatalogue</a>
    </div>

    <div class="col-md-4 text-center">
      <a href="/about">About</a> |
      <a href="/privacy">Privacy</a> |
      <a href="http://wiki.myexperiment.org/index.php/Papers">Publications</a> |
      <a href="/feedback">Contact / Feedback</a> |
      <a href="http://lists.nongnu.org/mailman/listinfo/myexperiment-discuss">Mailing List</a>
    </div>

    <div class="col-md-4 text-right">
      Icons: <a href="http://www.famfamfam.com/lab/icons/silk/">Silk icon set 1.3</a><br/><br/>
      
    </div>

  </div>
  <div class="row">
    <div class="col-md-12 text-center">
      Copyright &#169; 2007 &ndash; 2018
      <a href="http://www.manchester.ac.uk/">The University of Manchester</a>
      and
      <a href="http://www.soton.ac.uk/">University of Southampton</a>
    </div>
  </div>
</div>

        </div>
    



<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-1498417-4', 'auto');
    ga('set', 'anonymizeIp', true);
    ga('send', 'pageview');
</script>




</body>
</html>

